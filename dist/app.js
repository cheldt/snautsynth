/*! KineticJS v5.0.1 2014-01-21 http://www.kineticjs.com by Eric Rowell @ericdrowell - MIT License https://github.com/ericdrowell/KineticJS/wiki/License*/

/**
 * @preserve IntegraXor Web SCADA - JavaScript Number Formatter
 * http://www.integraxor.com/
 * author: KPL, KHL
 * (c)2011 ecava
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */

define("mout/lang/kindOf",[],function(){function r(r){return r===null?"Null":r===n?"Undefined":e.exec(t.call(r))[1]}var e=/^\[object (.*)\]$/,t=Object.prototype.toString,n;return r}),define("mout/lang/isKind",["./kindOf"],function(e){function t(t,n){return e(t)===n}return t}),define("mout/lang/isBoolean",["./isKind"],function(e){function t(t){return e(t,"Boolean")}return t}),define("mout/function/identity",[],function(){function e(e){return e}return e}),define("mout/function/prop",[],function(){function e(e){return function(t){return t[e]}}return e}),define("mout/object/hasOwn",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return e}),define("mout/object/forIn",["./hasOwn"],function(e){function r(){n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],t=!0;for(var e in{toString:null})t=!1}function i(i,o,u){var a,f=0;t==null&&r();for(a in i)if(s(o,i,a,u)===!1)break;if(t){var l=i.constructor,c=!!l&&i===l.prototype;while(a=n[f++])if((a!=="constructor"||!c&&e(i,a))&&i[a]!==Object.prototype[a]&&s(o,i,a,u)===!1)break}}function s(e,t,n,r){return e.call(r,t[n],n,t)}var t,n;return i}),define("mout/object/forOwn",["./hasOwn","./forIn"],function(e,t){function n(n,r,i){t(n,function(t,s){if(e(n,s))return r.call(i,n[s],s,n)})}return n}),define("mout/lang/isArray",["./isKind"],function(e){var t=Array.isArray||function(t){return e(t,"Array")};return t}),define("mout/object/deepMatches",["./forOwn","../lang/isArray"],function(e,t){function n(e,t){var n=-1,r=e.length;while(++n<r)if(s(e[n],t))return!0;return!1}function r(e,t){var r=-1,i=t.length;while(++r<i)if(!n(e,t[r]))return!1;return!0}function i(t,n){var r=!0;return e(n,function(e,n){if(!s(t[n],e))return r=!1}),r}function s(e,n){return e&&typeof e=="object"?t(e)&&t(n)?r(e,n):i(e,n):e===n}return s}),define("mout/function/makeIterator_",["./identity","./prop","../object/deepMatches"],function(e,t,n){function r(r,i){if(r==null)return e;switch(typeof r){case"function":return typeof i!="undefined"?function(e,t,n){return r.call(i,e,t,n)}:r;case"object":return function(e){return n(e,r)};case"string":case"number":return t(r)}}return r}),define("mout/array/filter",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=[];if(t==null)return i;var s=-1,o=t.length,u;while(++s<o)u=t[s],n(u,s,t)&&i.push(u);return i}return t}),define("mout/array/unique",["./filter"],function(e){function t(t,r){return r=r||n,e(t,function(e,t,n){var i=n.length;while(++t<i)if(r(e,n[t]))return!1;return!0})}function n(e,t){return e===t}return t}),define("mout/array/every",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=!0;if(t==null)return i;var s=-1,o=t.length;while(++s<o)if(!n(t[s],s,t)){i=!1;break}return i}return t}),define("mout/array/indexOf",[],function(){function e(e,t,n){n=n||0;if(e==null)return-1;var r=e.length,i=n<0?r+n:n;while(i<r){if(e[i]===t)return i;i++}return-1}return e}),define("mout/array/contains",["./indexOf"],function(e){function t(t,n){return e(t,n)!==-1}return t}),define("mout/array/slice",[],function(){function e(e,t,n){var r=e.length;t==null?t=0:t<0?t=Math.max(r+t,0):t=Math.min(t,r),n==null?n=r:n<0?n=Math.max(r+n,0):n=Math.min(n,r);var i=[];while(t<n)i.push(e[t++]);return i}return e}),define("mout/array/intersection",["./unique","./filter","./every","./contains","./slice"],function(e,t,n,r,i){function s(s){var o=i(arguments,1),u=t(e(s),function(e){return n(o,function(t){return r(t,e)})});return u}return s}),define("mout/array/compact",["./filter"],function(e){function t(t){return e(t,function(e){return e!=null})}return t}),define("mout/array/remove",["./indexOf"],function(e){function t(t,n){var r=e(t,n);r!==-1&&t.splice(r,1)}return t}),define("mout/object/keys",["./forOwn"],function(e){var t=Object.keys||function(t){var n=[];return e(t,function(e,t){n.push(t)}),n};return t}),define("mout/object/size",["./forOwn"],function(e){function t(t){var n=0;return e(t,function(){n++}),n}return t}),define("dejavu/lib/functionMeta",[],function(){function e(e,t){var n=/^function(\s+[a-zA-Z0-9_\$]*)*\s*\(([^\(]*)\)/m.exec(e.toString()),r,i,s=!1,o,u;if(!n)return null;i=(n[2]||"").split(/\s*,\s*/gm),o=i.length,r={mandatory:0,optional:0,signature:""};if(i[0]!==""){for(u=0;u<o;u+=1)if(i[u].charAt(0)==="$")r.optional+=1,r.signature+=i[u]+", ",s=!0;else{if(!!s)return null;r.mandatory+=1,r.signature+=i[u]+", "}r.signature=r.signature.substr(0,r.signature.length-2)}return t&&(t.charAt(0)==="_"?t.charAt(1)==="_"?r.isPrivate=!0:r.isProtected=!0:r.isPublic=!0),r}return e}),define("mout/lang/isNumber",["./isKind"],function(e){function t(t){return e(t,"Number")}return t}),define("mout/lang/isString",["./isKind"],function(e){function t(t){return e(t,"String")}return t}),define("dejavu/lib/isImmutable",["mout/lang/isNumber","mout/lang/isString","mout/lang/isBoolean"],function(e,t,n){function r(r){return r==null||n(r)||e(r)||t(r)}return r}),define("dejavu/lib/propertyMeta",["./isImmutable"],function(e){function t(t,n){var r={};return t===undefined?null:(n&&(n.charAt(0)==="_"?n.charAt(1)==="_"?r.isPrivate=!0:r.isProtected=!0:r.isPublic=!0),r.isImmutable=e(t),r)}return t}),define("dejavu/lib/isFunctionCompatible",[],function(){function e(e,t){return e.mandatory===t.mandatory&&e.optional>=t.optional}return e}),define("mout/array/append",[],function(){function e(e,t){if(t==null)return e;var n=e.length,r=-1,i=t.length;while(++r<i)e[n+r]=t[r];return e}return e}),define("dejavu/lib/checkKeywords",["mout/object/hasOwn","mout/array/append"],function(e,t){function s(t,s){var o=s==="normal"||!s?n:s==="all"?r:i,u;for(u=o.length-1;u>=0;u-=1)if(e(t,o[u]))throw new Error('"'+t.$name+'" is using a reserved keyword: '+o[u])}var n=["$constructor","$initializing","$static","$self","$super","$underStrict"],r=t(["initialize"],n),i=["$parent","$super","$self","$static","extend"];return s}),define("mout/array/some",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=!1;if(t==null)return i;var s=-1,o=t.length;while(++s<o)if(n(t[s],s,t)){i=!0;break}return i}return t}),define("mout/array/difference",["./unique","./filter","./some","./contains","./slice"],function(e,t,n,r,i){function s(s){var o=i(arguments,1),u=t(e(s),function(e){return!n(o,function(t){return r(t,e)})});return u}return s}),define("dejavu/lib/testKeywords",["mout/array/difference","mout/object/hasOwn"],function(e,t){function r(r,i){var s=i?e(n,i):n,o;for(o=s.length-1;o>=0;o-=1)if(t(r,s[o]))return s[o];return!1}var n=["$name","$extends","$implements","$borrows","$statics","$finals","$abstracts","$constants"];return r}),define("mout/lang/isFunction",["./isKind"],function(e){function t(t){return e(t,"Function")}return t}),define("dejavu/lib/hasDefineProperty",["mout/lang/isFunction"],function(e){function t(){if(!e(Object.defineProperty))return!1;try{Object.defineProperty({},"x",{})}catch(t){return!1}return!0}return t()}),define("dejavu/lib/isObjectPrototypeSpoiled",[],function(){function e(){var e={},t;for(t in e)if(t)return!0;return!1}return e}),define("dejavu/lib/checkObjectPrototype",["./isObjectPrototypeSpoiled","mout/lang/isFunction"],function(e,t){function n(){if(e())throw new Error("dejavu will not work properly if Object.prototype has enumerable properties!");t(Object.seal)&&!Object.isSealed(Object.prototype)&&Object.seal(Object.prototype)}return n}),define("dejavu/lib/randomAccessor",["mout/array/contains"],function(e){function s(s){if(i>r||!e(n,s))throw new Error("Can't access random identifier.");return i+=1,t}var t,n=["ClassWrapper","InterfaceWrapper","AbstractClassWrapper","FinalClassWrapper","instanceOfWrapper","inspectWrapper"],r=n.length,i=0;return typeof window=="undefined"||!window.navigator||!window.document?t=process.pid:t=(new Date).getTime()+"_"+Math.floor(Math.random()*1e8+1),s}),define("dejavu/options",[],function(){return{locked:!0}}),define("mout/object/mixIn",["./forOwn"],function(e){function t(t,r){var i=0,s=arguments.length,o;while(++i<s)o=arguments[i],o!=null&&e(o,n,t);return t}function n(e,t){this[t]=e}return t}),define("mout/lang/createObject",["../object/mixIn"],function(e){function t(t,n){function r(){}return r.prototype=t,e(new r,n)}return t}),define("mout/lang/isObject",["./isKind"],function(e){function t(t){return e(t,"Object")}return t}),define("dejavu/lib/inspect",["./randomAccessor","./hasDefineProperty","mout/lang/createObject","mout/lang/isObject","mout/lang/isArray","mout/lang/isFunction","mout/object/hasOwn"],function(e,t,n,r,i,s,o){function d(e,t){var n,r=t.length,i;for(n=0;n<r;n+=1){i=t[n];if(i.target===e)return i.inspect}return null}function v(e,r){if(!t)return e;var i,s,u,f,h,p,v;h=d(e,r.instances);if(h)return h;i=e.$static[a],s=i.simpleConstructor,u=e[l].methods,f=e[l].properties,h=n(s.prototype),r.instances.push({target:e,inspect:h});for(v in e[c].methods)h[v]=g(u[v],r,!0);for(v in e[c].properties)p=o(f,v)?f[v]:e[v],h[v]=g(p,r,!0);u=i.methods,f=i.properties;for(v in e)o(e,v)&&!o(h,v)&&!f[v]&&!u[v]&&(h[v]=g(e[v],r,!0));p=h.constructor.$constructor;while(p)m(p,r,!0),p=p.$parent;return h}function m(e,n){if(!t)return e;var r,i,s,u,f,c,h;f=d(e,n.constructors);if(f)return f;r=e[a],f=r.simpleConstructor,i=e[l].methods,s=e[l].properties,n.constructors.push({target:e,inspect:f});for(h in i)f[h]=g(i[h],n,!0);for(h in s)c=s[h],f[h]=g(c,n,!0);i=r.methods,s=r.properties;for(h in e)o(e,h)&&!o(f,h)&&!s[h]&&!i[h]&&(f[h]=g(e[h],n,!0));f=f.prototype,e=e.prototype,u=r.ownMembers,i=r.methods,s=r.properties;for(h in u)c=i[h]?i[h].implementation:s[h].value,f[h]=g(c,n,!0);for(h in e)o(e,h)&&!o(f,h)&&!u[h]&&(f[h]=g(e[h],n,!0));return f}function g(e,t,n){var o,u,l,c;t=t||{others:[],instances:[],constructors:[]};if(r(e)){if(e.$static)return v(e,t);c=d(e,t.others);if(c)return c;c={},t.others.push({target:e,inspect:c});for(o in e)c[o]=g(e[o],t,n);return c}if(i(e)){c=d(e,t.others);if(c)return c;c=[],t.others.push({target:e,inspect:c}),l=e.length;for(u=0;u<l;u+=1)c.push(g(e[u],t,n));return c}return s(e)?e[a]?m(e,t):e[f]||e:e}var u=e("inspectWrapper"),a="$class_"+u,f="$wrapped_"+u,l="$cache_"+u,c="$redefined_cache_"+u,h,p;Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,Array.prototype.concat.apply(n,arguments))}}),typeof console=="object"&&(!console.inspect||!console.inspect.dejavu)&&(p=typeof navigator!="undefined"&&/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent),h=console.inspect||(p?console.dir||console.log:console.log),typeof h=="object"&&(h=Function.prototype.call.bind(h,console)),console.inspect=function(){var e=[],t=arguments.length,n;for(n=0;n<t;n+=1)e[n]=g(arguments[n]);return h.apply(console,e)},console.inspect.dejavu=!0)}),define("dejavu/lib/printWarning",[],function(){function e(e){typeof console!="undefined"&&console.warn(e)}return e}),define("dejavu/lib/obfuscateProperty",["./hasDefineProperty"],function(e){function t(t,n,r,i,s){e?Object.defineProperty(t,n,{value:r,configurable:s||!1,writable:i||!1,enumerable:!1}):t[n]=r}return t}),define("mout/lang/isDate",["./isKind"],function(e){function t(t){return e(t,"Date")}return t}),define("mout/lang/isRegExp",["./isKind"],function(e){function t(t){return e(t,"RegExp")}return t}),define("mout/array/combine",["./indexOf"],function(e){function t(t,n){if(n==null)return t;var r=-1,i=n.length;while(++r<i)e(t,n[r])===-1&&t.push(n[r]);return t}return t}),define("mout/lang/isPlainObject",[],function(){function e(e){return!!e&&typeof e=="object"&&e.constructor===Object}return e}),define("mout/lang/clone",["./kindOf","./isPlainObject","../object/mixIn"],function(e,t,n){function r(t){switch(e(t)){case"Object":return i(t);case"Array":return u(t);case"RegExp":return s(t);case"Date":return o(t);default:return t}}function i(e){return t(e)?n({},e):e}function s(e){var t="";return t+=e.multiline?"m":"",t+=e.global?"g":"",t+=e.ignorecase?"i":"",new RegExp(e.source,t)}function o(e){return new Date(+e)}function u(e){return e.slice()}return r}),define("mout/lang/deepClone",["./clone","../object/forOwn","./kindOf","./isPlainObject"],function(e,t,n,r){function i(t,r){switch(n(t)){case"Object":return s(t,r);case"Array":return o(t,r);default:return e(t)}}function s(e,n){if(r(e)){var s={};return t(e,function(e,t){this[t]=i(e,n)},s),s}return n?n(e):e}function o(e,t){var n=[],r=-1,s=e.length,o;while(++r<s)n[r]=i(e[r],t);return n}return i}),define("dejavu/lib/mixIn",[],function(){function e(e,t){var n,r=arguments.length,i,s;for(n=1;n<r;n+=1){s=arguments[n];for(i in arguments[n])e[i]=s[i]}return e}return e}),define("mout/function/bind",["../array/slice"],function(e){function t(t,n,r){var i=e(arguments,2);return function(){return t.apply(n,i.concat(e(arguments)))}}return t}),define("mout/lang/GLOBAL",[],function(){return Function("return this")()}),define("mout/lang/toArray",["./kindOf","./GLOBAL"],function(e,t){function n(n){var r=[],i=e(n),s;if(n!=null)if(n.length==null||i==="String"||i==="Function"||i==="RegExp"||n===t)r[r.length]=n;else{s=n.length;while(s--)r[s]=n[s]}return r}return n}),define("mout/array/insert",["./difference","./slice"],function(e,t){function n(n,r){var i=e(t(arguments,1),n);return i.length&&Array.prototype.push.apply(n,i),n.length}return n}),define("dejavu/Class",["mout/lang/isBoolean","mout/array/intersection","mout/array/unique","mout/array/compact","mout/array/remove","mout/object/keys","mout/object/size","./lib/functionMeta","./lib/propertyMeta","./lib/isFunctionCompatible","./lib/checkKeywords","./lib/testKeywords","./lib/hasDefineProperty","./lib/checkObjectPrototype","./lib/randomAccessor","./options","./lib/inspect","./lib/printWarning","./lib/obfuscateProperty","./lib/isImmutable","mout/lang/isString","mout/lang/isFunction","mout/lang/isObject","mout/lang/isArray","mout/lang/isDate","mout/lang/isRegExp","mout/lang/createObject","mout/object/hasOwn","mout/array/combine","mout/array/contains","mout/lang/deepClone","./lib/mixIn","mout/function/bind","mout/lang/toArray","mout/array/insert"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H){function Z(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function et(e,t,n,r){t[X]&&(t=t[X]);var i=n.$parent,s=i&&(r?i:i.prototype),o=i&&i[I][r?"staticMethods":"methods"][e],u=i&&i[I].locked&&!i[I].forceUnlocked,a,f;return o?!r&&o.isPrivate&&e==="initialize"?(a=tt,s=null):a=o.implementation:a=bt,f=function(){var r=this==null||this===Y?{}:this,i=r.$super,o=r.$self,f,l,c;c=u||!s?a:s[e],f=K,K={method:t,constructor:n,constructorId:n[I].id},r.$super=c,r.$self=n;try{l=t.apply(this,arguments)}finally{r.$super=i,r.$self=o,K=f}return l},b(f,X,t),t[z]&&b(f,z,t[z]),f}function tt(){throw new Error('Cannot call parent constructor in class "'+this.$name+"\" because it's declared as private.")}function nt(e,t,n,r){r=r||{};var i,s=!!r.isStatic,o=!!r.forcePublic||!!n[I].isVanilla,u,f,c,h,d;t[X]&&(t=t[X]),t[z]?t[z]!==e&&(c=t,t=function(){return c.apply(this,arguments)},b(t,z,e)):b(t,z,e);if(!s&&e==="initialize"&&t.$inherited)i=_({},n.$parent[I].methods[e]),d=!0,delete t.$inherited;else if(r.metadata)i=r.metadata,u=i.isFinal;else{if(t[X])throw new Error("Cannot grab metadata from wrapped method.");i=a(t,e);if(!i)throw new Error((s?"Static method":"Method")+' "'+e+'" contains optional arguments before mandatory ones in class "'+n.prototype.$name+'".');i.isFinal=u=!!r.isFinal,s?n[I].staticMethods[e]&&(i.allowed=n[I].staticMethods[e].allowed):n[I].methods[e]&&(i.allowed=n[I].methods[e].allowed)}o&&it(i),e==="initialize"&&t.$prefix!=null&&(t.$prefix==="_"?i.isProtected=!0:t.$prefix==="__"&&(i.isPrivate=!0),delete t.$prefix);if(i.isPrivate&&u)throw new Error('Private method "'+e+'" cannot be classified as final in class "'+n.prototype.$name+'".');f=s?n[I].staticProperties:n[I].properties;if(x(f[e]))throw new Error((s?"Static method":"Method")+' "'+e+'" is overwriting a '+(s?"static ":"")+'property with the same name in class "'+n.prototype.$name+'".');f=s?n[I].staticMethods:n[I].methods;if(x(f[e])){if(f[e].forcedPublic)it(i);else if(f[e].isPrivate&&e!=="initialize")throw new Error("Cannot override private "+(s?"static ":"")+' method "'+e+'" in class "'+n.prototype.$name+'".');if(f[e].isFinal)throw new Error('Cannot override final method "'+e+'" in class "'+n.prototype.$name+'".');if(i.checkCompatibility&&!l(i,f[e]))throw new Error((s?"Static method":"Method")+' "'+e+"("+i.signature+')" defined in abstract class "'+n.prototype.$name+'" overrides its ancestor but it is not compatible with its signature: "'+e+"("+f[e].signature+')".')}f[e]=i,s||(n[I].ownMembers[e]=!0),h=t,t=et(e,t,n,s),b(t,z,e),i.implementation=t;if(i.isPublic||!p)f=s?n:n.prototype,f[e]=t;h[U]&&(s||H(n[I].binds,e),delete h[U]),i.isProtected?i.allowed?H(i.allowed,n[I].id):i.allowed=[n[I].id]:i.isPrivate&&(i.allowed=n[I].id)}function rt(e,t,n,r){r=r||{};var i,s,o,u,a=!!r.forcePublic||!!n[I].isVanilla,l;if(r.metadata)i=r.metadata,o=i.isFinal,u=i.isConst,s=!!r.isStatic||u;else{i=f(t,e);if(!i)throw new Error('Value of property "'+e+'"  in class "'+n.prototype.$name+'" cannot be parsed (undefined values are not allowed).');i.isFinal=o=!!r.isFinal,i.isConst=u=!!r.isConst,s=!!r.isStatic||u,s?n[I].staticProperties[e]&&(i.allowed=n[I].staticProperties[e].allowed):n[I].properties[e]&&(i.allowed=n[I].properties[e].allowed)}a&&it(i);if(!i)throw new Error("Value of "+(u?"constant ":s?"static ":"")+' property "'+e+'" defined in class "'+n.prototype.$name+"\" can't be undefined (use null instead).");if(u&&!i.isImmutable)throw new Error('Value for constant "'+e+'" defined in class "'+n.prototype.$name+'" must be a primitive type (immutable).');if(i.isPrivate&&o)throw new Error((s?"Static property":"Property")+' "'+e+'" cannot be classified as final in class "'+n.prototype.$name+'".');l=s?n[I].staticMethods:n[I].methods;if(x(l[e]))throw new Error((u?"Constant property":s?"Static property":"Property")+' "'+e+'" is overwriting a '+(s?"static ":"")+'method with the same name in class "'+n.prototype.$name+'".');l=s?n[I].staticProperties:n[I].properties;if(x(l[e])){if(l[e].forcedPublic)it(i);else if(l[e].isPrivate)throw new Error("Cannot override private "+(u?"constant ":s?"static ":"")+' property "'+e+' in class "'+n.prototype.$name+'".');if(l[e].isConst)throw new Error('Cannot override constant property "'+e+'" in class "'+n.prototype.$name+'".');if(l[e].isFinal)throw new Error('Cannot override final property "'+e+'" in class "'+n.prototype.$name+'".')}l[e]=i,i.value=t,s||(n[I].ownMembers[e]=!0);if(i.isPublic||!p)l=s?n:n.prototype,l[e]=t;o?i.isFinal=o:u&&(i.isConst=u),i.isProtected?i.allowed?H(i.allowed,n[I].id):i.allowed=[n[I].id]:i.isPrivate&&(i.allowed=n[I].id)}function it(e){delete e.isProtected,delete e.isPrivate,e.isPublic=e.forcedPublic=!0}function st(e,t){var n,r,i={forcePublic:!0};for(n in e){if(/^(_){0,2}initialize$/.test(n))continue;r=e[n],L(t.prototype,n)||(S(r)&&!r[I]&&!r[q]?nt(n,r,t,i):rt(n,r,t,i))}t[I].forceUnlocked=!0}function ot(e,t){if(L(e,"$borrows")){var n,s=P(e.$borrows),o=s.length,u,a={};if(!o&&!T(e.$borrows))throw new Error('$borrows of class "'+t.prototype.$name+'" must be a class/object or an array of classes/objects.');if(o!==r(s).length&&i(s).length===o)throw new Error('There are duplicate entries defined in $borrows of class "'+t.prototype.$name+'".');for(o-=1;o>=0;o-=1){n=s[o];if(x(n)){if(n.$static)throw new Error("Entry at index "+o+' in $borrows of class "'+t.prototype.$name+'" is not a valid class/object.');st(n,t);continue}if(!S(n)||!!n[q])throw new Error("Entry at index "+o+' in $borrows of class "'+t.prototype.$name+'" is not a valid class/object.');if(!n[I]){st(n.prototype,t);continue}n=n.prototype;if(n.$static[R]&&n.$static[R].unimplemented)throw new Error("Entry at index "+o+' in $borrows of class "'+t.prototype.$name+'" is an abstract class with abstract members, which are not allowed.');if(n.$static.$parent)throw new Error("Entry at index "+o+' in $borrows of class "'+t.prototype.$name+'" is an inherited class (only root classes are supported).');delete a.isStatic;for(u in n.$static[I].methods)L(t.prototype,u)||(a.metadata=_({},n.$static[I].methods[u]),delete a.metadata.allowed,nt(u,a.metadata.implementation||n[u],t,a));for(u in n.$static[I].properties)L(t.prototype,u)||(a.metadata=_({},n.$static[I].properties[u]),delete a.metadata.allowed,rt(u,a.metadata.value||n[u],t,a));a.isStatic=!0;for(u in n.$static[I].staticMethods)a.metadata=_({},n.$static[I].staticMethods[u]),delete a.metadata.allowed,nt(u,a.metadata.implementation||n.$static[u],t,a);for(u in n.$static[I].staticProperties)a.metadata=_({},n.$static[I].staticProperties[u]),delete a.metadata.allowed,rt(u,a.metadata.value||n.$static[u],t,a);n.$static[I].isVanilla&&(t[I].forceUnlocked=!0),A(t[I].binds,n.$static[I].binds)}delete e.$borrows}}function ut(e,t){var n=P(e),s,o=n.length,u,a={isConst:!0};if(!o&&!T(e))throw new Error('$implements of class "'+t.prototype.$name+'" must be an interface or an array of interfaces.');if(o!==r(n).length&&i(n).length===o)throw new Error('There are duplicate entries in $implements of class "'+t.prototype.$name+'".');for(o-=1;o>=0;o-=1){s=n[o];if(!S(s)||!s[q])throw new Error("Entry at index "+o+' in $implements of class "'+t.prototype.$name+'" is not a valid interface.');if(!O(t[I].interfaces,s)){for(u in s[q].constants)rt(u,s[u],t,a);t[I].interfaces.push(s)}t[R]||n[o][q].check(t)}}function at(e,t,n){var r={isFinal:!!n},i,s,o={},u;if(L(e,"$statics")){if(!x(e.$statics))throw new Error('$statics definition of class "'+e.$name+'" must be an object.');c(e.$statics,"statics"),u=h(e.$statics);if(u)throw new Error("$statics "+(n?"inside $finals ":"")+' of class "'+t.prototype.$name+'" contains an unallowed keyword: "'+u+'".');r.isStatic=!0;for(i in e.$statics)s=e.$statics[i],S(s)&&!s[I]&&!s[q]?nt(i,s,t,r):rt(i,s,t,r);delete r.isStatic,delete e.$statics}L(e,"$implements")&&(o.$implements=e.$implements,delete e.$implements),L(e,"$abstracts")&&(o.$abstracts=e.$abstracts,delete e.$abstracts);for(i in e)s=e[i],S(s)&&!s[I]&&!s[q]?nt(i,s,t,r):rt(i,s,t,r);_(e,o)}function ft(e,r){var i={},u,a,f={},l,p;if(L(e,"$constants")){if(!x(e.$constants))throw new Error('$constants of class "'+r.prototype.$name+'" must be an object.');c(e.$constants,"statics"),l=h(e.$constants);if(l)throw new Error('$constants of class "'+r.prototype.$name+'" contains an unallowed keyword: "'+l+'".');if(x(e.$statics)){p=n(o(e.$constants),o(e.$statics));if(p.length)throw new Error('There are members defined in class "'+r.prototype.$name+'" with the same name but with different modifiers: "'+p.join('", ')+'".')}f.$constants=e.$constants,delete e.$constants}if(L(e,"$finals")){if(!x(e.$finals))throw new Error('$finals of class "'+r.prototype.$name+'" must be an object.');c(e.$finals),l=h(e.$finals,["$statics"]);if(l)throw new Error('$finals of class "'+r.prototype.$name+'" contains an unallowed keyword: "'+l+'".');if(x(e.$finals.$statics)){if(x(e.$statics)){p=n(o(e.$finals.$statics),o(e.$statics));if(p.length)throw new Error('There are members defined in class "'+r.prototype.$name+'" with the same name but with different modifiers: "'+p.join('", ')+'".')}if(f.$constants){p=n(o(e.$finals.$statics),o(f.$constants));if(p.length)throw new Error('There are members defined in class "'+r.prototype.$name+'" with the same name but with different modifiers: "'+p.join('", ')+'".')}}p=n(o(e),o(e.$finals));if(p.length){s(p,"$statics");if(p.length)throw new Error('There are members defined in class "'+r.prototype.$name+'" with the same name but with different modifiers: "'+p.join('", ')+'".')}f.$finals=e.$finals,delete e.$finals}if(L(e,"$locked")){if(!t(e.$locked))throw new Error('$locked of class "'+r.prototype.name+'" must be a boolean.');f.$locked=e.$locked,delete e.$locked}at(e,r);if(f.$constants){i.isConst=!0;for(u in f.$constants)a=f.$constants[u],rt(u,a,r,i);delete i.isConst}f.$finals&&at(f.$finals,r,!0);if(L(f,"$locked")){if(r[I].forceUnlocked&&f.$locked)throw new Error('Class "'+r.prototype.$name+'" cannot be locked because it borrows or extends from a vanilla class.');if(r[I].locked===!1&&f.$locked)throw new Error('Class "'+r.prototype.$name+'" inherits from an unlocked class, therefore its subclasses cannot be locked.');r[I].locked=!!f.$locked,delete r.prototype.$locked}else L(r[I],"locked")||(r[I].locked=!!m.locked)}function lt(e,t){var n,r;for(n=e.length-1;n>=0;n-=1)r=t[e[n]],t[e[n]]=D(r,t),t[e[n]][z]=r.$name}function ct(e,t,n){n[V].methods[e]=t.implementation,t.isPrivate?Object.defineProperty(n,e,{get:function(){var i=n[V].methods[e],s=e==="initialize",o;o=K;if(n.$initializing||o&&(o.method[z]||o.method[W])&&t.allowed===o.constructorId)return i;throw s?new Error('Constructor of class "'+n.$name+'" is private.'):new Error('Cannot access private method "'+e+'" of class "'+n.$name+'".')},set:function(r){if(!(n.$initializing||!n.$static[I].locked||n.$static[I].forceUnlocked))throw new Error('Cannot set private method "'+e+'" of class "'+n.$name+'".');n[V].methods[e]=r,n[$].methods[e]=!0},configurable:!1,enumerable:!0}):t.isProtected?Object.defineProperty(n,e,{get:function(){var i=n[V].methods[e],s=e==="initialize",o;o=K;if(n.$initializing||o&&(o.method[z]||o.method[W])&&(O(t.allowed,o.constructorId)||n instanceof o.constructor))return i;throw s?new Error('Constructor of class "'+n.$name+'" is protected.'):new Error('Cannot access protected method "'+e+'" of class "'+n.$name+'".')},set:function(r){if(!(n.$initializing||!n.$static[I].locked||n.$static[I].forceUnlocked))throw new Error('Cannot set protected method "'+e+'" of class "'+n.$name+'".');n[V].methods[e]=r,n[$].methods[e]=!0},configurable:!1,enumerable:!0}):Object.defineProperty(n,e,{get:function(){return n[V].methods[e]},set:function(r){if(!(n.$initializing||!n.$static[I].locked||n.$static[I].forceUnlocked))throw new Error('Cannot set public method "'+e+'" of class "'+n.$name+'".');n[V].methods[e]=r,n[$].methods[e]=!0},configurable:!1,enumerable:!0})}function ht(e,t,n){n[V].methods[e]=t.implementation,t.isPrivate?Object.defineProperty(n,e,{get:function(){var i=n[V].methods[e],s;s=K;if(s&&(s.method[z]||s.method[W])&&t.allowed===s.constructorId)return i;throw new Error('Cannot access private static method "'+e+'" of class "'+n.prototype.$name+'".')},set:function(r){if(!!n[I].locked&&!n[I].forceUnlocked)throw new Error('Cannot set private static method "'+e+'" of class "'+n.prototype.$name+'".');n[V].methods[e]=r},configurable:!1,enumerable:!0}):t.isProtected?Object.defineProperty(n,e,{get:function(){var i=n[V].methods[e],s;s=K;if(s&&(s.method[z]||s.method[W])&&(O(t.allowed,s.constructorId)||n.prototype instanceof s.constructor))return i;throw new Error('Cannot access protected static method "'+e+'" of class "'+n.prototype.$name+'".')},set:function(r){if(!!n[I].locked&&!n[I].forceUnlocked)throw new Error('Cannot set protected static method "'+e+'" of class "'+n.prototype.$name+'".');n[V].methods[e]=r},configurable:!1,enumerable:!0}):Object.defineProperty(n,e,{get:function(){return n[V].methods[e]},set:function(r){if(!!n[I].locked&&!n[I].forceUnlocked)throw new Error('Cannot set public static method "'+e+'" of class "'+n.prototype.$name+'".');n[V].methods[e]=r},configurable:!1,enumerable:!0})}function pt(e,t,n){t.isPrivate?(t.isImmutable?n[V].properties[e]=t.value:(n[V].properties[e]=M(t.value),n[$].properties[e]=!0),Object.defineProperty(n,e,{get:function(){var i=K;if(n.$initializing||i&&(i.method[z]||i.method[W])&&t.allowed===i.constructorId)return n[V].properties[e];throw new Error('Cannot access private property "'+e+'" of class "'+n.$name+'".')},set:function(i){var s=K;if(!(n.$initializing||s&&(s.method[z]||s.method[W])&&t.allowed===s.constructorId))throw new Error('Cannot set private property "'+e+'" of class "'+n.$name+'".');n[V].properties[e]=i,n[$].properties[e]=!0},configurable:!1,enumerable:!0})):t.isProtected?(t.isImmutable?n[V].properties[e]=t.value:(n[V].properties[e]=M(t.value),n[$].properties[e]=!0),Object.defineProperty(n,e,{get:function(){var i=K;if(n.$initializing||i&&(i.method[z]||i.method[W])&&(O(t.allowed,i.constructorId)||n instanceof i.constructor))return n[V].properties[e];throw new Error('Cannot access protected property "'+e+'" of class "'+n.$name+'".')},set:function(i){var s=K;if(!(n.$initializing||s&&(s.method[z]||s.method[W])&&(O(t.allowed,s.constructorId)||n instanceof s.constructor)))throw new Error('Cannot set protected property "'+e+'" of class "'+n.$name+'".');n[V].properties[e]=i,n[$].properties[e]=!0},configurable:!1,enumerable:!0})):t.isImmutable?n[e]=t.value:(n[e]=M(n[e]),n[$].properties[e]=!0)}function dt(e,t,n){n[V].properties[e]=t.value,t.isPrivate?Object.defineProperty(n,e,{get:function(){var i=K;if(i&&(i.method[z]||i.method[W])&&t.allowed===i.constructorId)return n[V].properties[e];throw new Error('Cannot access private static property "'+e+'" of class "'+n.prototype.$name+'".')},set:t.isConst?function(){throw new Error('Cannot change value of constant property "'+e+'" of class "'+n.prototype.$name+'".')}:function(i){var s=K;if(!s||!s.method[z]&&!s.method[W]||t.allowed!==s.constructorId)throw new Error('Cannot set private property "'+e+'" of class "'+n.prototype.$name+'".');n[V].properties[e]=i},configurable:!1,enumerable:!0}):t.isProtected?Object.defineProperty(n,e,{get:function(){var i=K;if(i&&(i.method[z]||i.method[W])&&(O(t.allowed,i.constructorId)||n.prototype instanceof i.constructor))return n[V].properties[e];throw new Error('Cannot access protected static property "'+e+'" of class "'+n.prototype.$name+'".')},set:t.isConst?function(){throw new Error('Cannot change value of constant property "'+e+'" of class "'+n.prototype.$name+'".')}:function(i){var s=K;if(!s||!s.method[z]&&!s.method[W]||!(O(t.allowed,s.constructorId)||n.prototype instanceof s.constructor))throw new Error('Cannot set protected static property "'+e+'" of class "'+n.prototype.$name+'".');n[V].properties[e]=i},configurable:!1,enumerable:!0}):t.isConst&&Object.defineProperty(n,e,{get:function(){return n[V].properties[e]},set:function(){throw new Error('Cannot change value of constant property "'+e+'" of class "'+n.prototype.$name+'".')},configurable:!1,enumerable:!0})}function vt(e){var t;b(e,V,{properties:{},methods:{}}),b(e,$,{properties:{},methods:{}});for(t in e.$static[I].methods)ct(t,e.$static[I].methods[t],e);for(t in e.$static[I].properties)pt(t,e.$static[I].properties[t],e)}function mt(e){var t,n,r,i=e.prototype;b(e,V,{properties:{},methods:{}});for(t in e[I].staticMethods)ht(t,e[I].staticMethods[t],e);for(t in e[I].staticProperties)dt(t,e[I].staticProperties[t],e);S(Object.seal)&&e[I].locked&&!e[I].forceUnlocked&&(Object.seal(e),Object.seal(i))}function gt(e,t){var n=e||function r(){var e,n;if(!(this instanceof r))throw new Error("Constructor called as a function, use the new keyword instead.");if(t)throw new Error("An abstract class cannot be instantiated.");b(this,"$initializing",!0,!0,!0),b(this,"$super",null,!0),b(this,"$self",null,!0),n=this.$static[I];if(p)vt(this);else for(e in n.properties)n.properties[e].isImmutable||(this[e]=M(this[e]));n.binds.length&&lt(n.binds,this,this),delete this.$initializing,!n.forceUnlocked&&n.locked&&S(Object.seal)&&Object.seal(this),this.initialize.apply(this,arguments)};return n[I]||(b(n,I,{methods:{},properties:{},staticMethods:{},staticProperties:{},ownMembers:{},interfaces:[],binds:[]}),p&&(n[I].simpleConstructor=function(){},b(n[I].simpleConstructor,"$constructor",n))),n}function yt(e){e=e||this;if(e[z])return e;if(!K)throw new Error("Attempting to mark a function as a member outside an instance/class.");if(e[W])throw new Error("Function is already marked as an member.");return e[W]=!0,e=et(null,e,K.constructor),e[W]=!0,e}function bt(){throw new Error("Trying to call $super when there is no parent function.")}function wt(e){var t=P(arguments),n,r;return this&&!e[X]&&this.$static&&this.$static[I]&&(e[W]=!0,e=et(null,e,this.$self||this.$static),t[0]=e,r=!0),t.splice(1,0,this),n=D.apply(e,t),r&&(n[W]=e[W]=!0),n}function Et(e){var t=P(arguments),n,r;return this&&!e[X]&&this.$static&&this.$static[I]&&(e[W]=!0,e=et(null,e,this.$self||this.$static,!0),t[0]=e,r=!0),t.splice(1,0,this),n=D.apply(e,t),r&&(n[W]=e[W]=!0),n}function St(e,t){var n,r=t[I].binds,i,s,o=e[I].id;for(n=r.length-1;n>=0;n-=1)r[n].substr(0,2)!=="__"&&e[I].binds.push(r[n]);for(i in t[I].methods)s=t[I].methods[i],e[I].methods[i]=s,s.isProtected&&s.allowed.push(o);for(i in t[I].properties)s=t[I].properties[i],e[I].properties[i]=s,s.isProtected&&s.allowed.push(o);for(i in t[I].staticMethods)s=t[I].staticMethods[i],s.isPrivate||(e[I].staticMethods[i]=s,e[i]=s.implementation,s.isProtected&&s.allowed.push(o));for(i in t[I].staticProperties)s=t[I].staticProperties[i],s.isPrivate||(e[I].staticProperties[i]=s,e[i]=s.value,s.isProtected&&s.allowed.push(o));p&&Z(e[I].simpleConstructor,t[I].simpleConstructor),L(t[I],"locked")&&(e[I].locked=t[I].locked),L(t[I],"forceUnlocked")&&(e[I].forceUnlocked=t[I].forceUnlocked),b(e,"$parent",t),e[I].interfaces=[].concat(t[I].interfaces)}function xt(e,t){return j.declare(this,e,t)}d();var B,j={},F=v("ClassWrapper"),I="$class_"+F,q="$interface_"+F,R="$abstract_"+F,U="$bound_"+F,z="$name_"+F,W="$anonymous_"+F,X="$wrapped_"+F,V="$cache_"+F,$="$redefined_cache_"+F,J=0,K=null,Q,G,Y=typeof window!="undefined"&&window.navigator&&window.document?window:global;Q=function(){return"[instance #"+this.$name+"]"},G=function(){return"[constructor #"+this.prototype.$name+"]"},B=function(e,t,n){n=n||{};var r,i,s,o,u,a;if(L(e,"$name")){if(!E(e.$name))throw new Error("Class name must be a string.");if(/\s+/.test(e.$name))throw new Error("Class name cannot have spaces.")}else e.$name="Unnamed";if(L(e,"$abstracts")&&!n.isAbstract)throw new Error('Class "'+e.$name+'" has abstract methods, therefore it must be defined as abstract.');if(!n.isVanilla){s=["__","_",""],a=!1;for(u=s.length-1;u>=0;u-=1){o=s[u]+"initialize";if(L(e,o)){if(!S(e[o]))throw new Error('The "'+o+'" member of class "'+e.$name+'" must be a function.');if(a)throw new Error('Several constructors with different visibility where found in class "'+e.$name+'".');a=!0,e[o].$prefix=s[u]}}}c(e,"normal");if(L(e,"$extends")){i=e.$extends,delete e.$extends;if(!S(i)||!!i[q])throw new Error('Specified parent class in $extends of "'+e.$name+'" is not a valid class.');i[I]||(i=B(i.prototype,i,{isVanilla:!0}));if(i[I].finalClass)throw new Error('Class "'+e.$name+'" cannot inherit from final class "'+i.prototype.$name+'".');r=gt(t,n.isAbstract),r[I].id=J+=1,n.isVanilla?(e.initialize=function(){r.apply(this,arguments)},r[I].forceUnlocked=!0,r[I].isVanilla=!0):!e.initialize&&!e._initialize&&!e.__initialize?(e.initialize=function(){i.prototype.initialize.apply(this,arguments)},e.initialize.$inherited=!0):e.initialize=e.initialize||e._initialize||e.__initialize,Z(r,i),St(r,i)}else r=gt(t,n.isAbstract),r[I].id=J+=1,n.isVanilla?(e.initialize=function(){r.apply(this,arguments)},r[I].forceUnlocked=!0,r[I].isVanilla=!0):e.initialize=e.initialize||e._initialize||e.__initialize||function(){};return n.isVanilla||(delete e._initialize,delete e.__initialize),n.isAbstract&&b(r,R,!0,!0),r.prototype.$name=e.$name,delete e.$name,ot(e,r),ft(e,r),b(r.prototype,"$static",r),b(r,"$static",r),b(r,"$self",null,!0),b(r,"$super",null,!0),b(r,"$member",yt),b(r,"$bind",Et),r.$parent||(b(r.prototype,"$bind",wt),b(r.prototype,"$member",yt)),e.toString===Object.prototype.toString&&b(r.prototype,"toString",Q,!0),r.toString===Function.prototype.toString&&b(r,"toString",G,!0),i&&i[R]&&!n.isAbstract&&i[R].check(r),L(e,"$implements")&&(ut(e.$implements,r),delete r.prototype.$implements),L(e,"$abstracts")&&delete e.$abstracts,r.extend=xt,p&&mt(r),r},j.declare=function(e,t,n){var r,i=S(this)?this:B,s,o;if(e&&t&&t!==!0){if(!S(e)||!e[I])throw new Error("Expected first argument to be a class.");(s=S(t))||n?(o=gt(),r=s?t(e.prototype,e,o):t):r=t;if(r.$extends)throw new Error("Object cannot contain an $extends property.");r.$extends=e}else(s=S(e))||t?(o=gt(),r=s?e(o):e):r=e;if(!x(r))throw new Error("Expected class definition to be an object with the class members.");return i(r,o)},b(j,"$create",B);if(!Function.prototype.$bound||!Function.prototype.$bound.dejavu)try{b(Function.prototype,"$bound",function(){return this[U]=!0,this}),Function.prototype.$bound.dejavu=!0}catch(Tt){y("Could not set Function.prototype.$bound.")}if(!Function.prototype.$bind||!Function.prototype.$bind.dejavu)try{b(Function.prototype,"$bind",function(e){var t=P(arguments);return t.splice(0,1,this),S(e)?Et.apply(e,t):wt.apply(e,t)}),Function.prototype.$bind.dejavu=!0}catch(Tt){y("Could not set Function.prototype.$bind.")}if(!Function.prototype.$member||!Function.prototype.$member.dejavu)try{b(Function.prototype,"$member",function(){return yt(this)}),Function.prototype.$member.dejavu=!0}catch(Tt){y("Could not set Function.prototype.$member.")}return j}),define("dejavu/lib/isFunctionEmpty",[],function(){function e(e){return/^function\s*\([^\(]*\)\s*\{\s*(["']use strict["'];)?\s*\}$/m.test(e.toString())}return e}),define("dejavu/AbstractClass",["mout/lang/isObject","mout/lang/isFunction","mout/lang/isString","mout/lang/toArray","mout/function/bind","./lib/functionMeta","./lib/isFunctionEmpty","./lib/isFunctionCompatible","./lib/checkKeywords","./lib/testKeywords","./lib/checkObjectPrototype","./lib/hasDefineProperty","./lib/randomAccessor","./lib/mixIn","mout/object/hasOwn","mout/array/insert","./Class"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function T(e,n,r,i){var s,f=i&&i.isStatic,l;if(e.substr(0,2)==="__")throw new Error('Abstract class "'+r.prototype.$name+'" contains an unallowed abstract '+(f?"static ":"")+'private method: "'+e+'".');if(!u(n))throw new Error((f?"Static method":"Method")+' "'+e+'" must be anonymous and contain no implementation in abstract class "'+r.prototype.$name+'".');l=f?r:r.prototype,s=o(n,e);if(s===null)throw new Error((f?"Static method":"Method")+' "'+e+'" contains optional arguments before mandatory ones in abstract class "'+r.prototype.$name+'".');l=f?r[b].staticProperties:r[b].properties;if(t(l[e]))throw new Error('Abstract method "'+e+'" defined in abstract class "'+r.prototype.$name+'" conflicts with an already defined property.');l=f?r[b].staticMethods:r[b].methods;if(t(l[e]))throw new Error('Abstract method "'+e+'" defined in abstract class "'+r.prototype.$name+'" seems to be already implemented and cannot be declared as abstract anymore.');l=f?r[E].staticMethods:r[E].methods;if(t(l[e])&&!a(s,l[e]))throw new Error((f?"Static method":"Method")+' "'+e+"("+s.signature+')" defined in abstract class "'+r.prototype.$name+'" overrides its ancestor but it is not compatible with its signature: "'+e+"("+l[e].signature+')".');!f&&n[S]&&m(r[b].binds,e),s.checkCompatibility=!0,l[e]=s}function N(e){var t,n;for(t in this[E].methods){n=this[E].methods[t];if(!e[b].methods[t])throw new Error('Class "'+e.prototype.$name+'" does not implement abstract class "'+this.prototype.$name+'" correctly, method "'+t+'" was not found.');if(!a(e[b].methods[t],n))throw new Error('Method "'+t+"("+e[b].methods[t].signature+')" defined in class "'+e.prototype.$name+'" is not compatible with the one found in abstract class "'+this.prototype.$name+'": "'+t+"("+n.signature+')".')}for(t in this[E].staticMethods){n=this[E].staticMethods[t];if(!e[b].staticMethods[t])throw new Error('Class "'+e.prototype.$name+'" does not implement abstract class "'+this.prototype.$name+'" correctly, static method "'+t+'" was not found.');if(!a(e[b].staticMethods[t],n))throw new Error('Static method "'+t+"("+e[b].staticMethods[t].signature+')" defined in class "'+e.prototype.$name+'" is not compatible with the one found in abstract class "'+this.prototype.$name+'": "'+t+"("+n.signature+')".')}}function C(e,r){var i={isStatic:!0},s,o,u;if(!t(e))throw new Error('$abstracts defined in abstract class "'+r.prototype.$name+'" must be an object.');f(e),u=l(e,["$statics"]);if(u)throw new Error('$statics inside $abstracts of abstract class "'+r.prototype.$name+'" contains an unallowed keyword: "'+u+'".');if(v(e,"$statics")){if(!t(e.$statics))throw new Error('$statics definition in $abstracts of abstract class "'+r.prototype.$name+'" must be an object.');f(e.$statics,"statics"),u=l(e.$statics);if(u)throw new Error('$statics inside $abstracts of abstract class "'+r.prototype.$name+'" contains an unallowed keyword: "'+u+'".');for(s in e.$statics){o=e.$statics[s];if(!n(o)||o[w]||o[b])throw new Error('Abstract member "'+s+'" found in abstract class "'+r.prototype.$name+'" is not a function.');T(s,o,r,i)}delete e.$statics}for(s in e){o=e[s];if(!n(o)||o[w]||o[b])throw new Error('Abstract member "'+s+'" found in abstract class "'+r.prototype.$name+'" is not a function.');T(s,o,r)}}function k(e,t){var n=i(e),r=n.length,s,o,u;for(r-=1;r>=0;r-=1){s=n[r];for(o in s[w].methods){u=s[w].methods[o];if(t[E].methods[o]){if(!a(t[E].methods[o],u))throw new Error('Method "'+o+"( "+u.signature+')" described in interface "'+s.prototype.$name+'" is not compatible with the one already defined in "'+t.prototype.$name+'": "'+o+"("+t[E].methods[o].signature+')".')}else t[E].methods[o]=s[w].methods[o]}for(o in s[w].staticMethods){u=s[w].staticMethods[o];if(t[E].staticMethods[o]){if(!a(t[E].staticMethods[o],u))throw new Error('Static method "'+o+"( "+u.signature+')" described in interface "'+s.prototype.$name+'" is not compatible with the one already defined in "'+t.prototype.$name+'": "'+o+"("+t[E].staticMethods[o].signature+')".')}else t[E].staticMethods[o]=u}}}function L(e,i){if(!t(e))throw new Error("Expected abstract class definition to be an object with the abstract class members.");if(v(e,"$name")){if(!r(e.$name))throw new Error("Abstract class name must be a string.");if(/\s+/.test(e.$name))throw new Error("Abstract class name cannot have spaces.")}else e.$name="Unnamed";var o,u={methods:{},staticMethods:{},unimplemented:0},a={},f;n(e.$extends)&&e.$extends[E]&&(d(u.methods,e.$extends[E].methods),d(u.staticMethods,e.$extends[E].staticMethods)),v(e,"$abstracts")&&(a.$abstracts=e.$abstracts),v(e,"$implements")&&(a.$interfaces=e.$implements),o=g.$create(e,i,{isAbstract:!0}),u.check=s(N,o),h?Object.defineProperty(o,E,{value:u,writable:!1}):o[E]=u,v(a,"$interfaces")&&k(a.$interfaces,o),v(a,"$abstracts")&&C(a.$abstracts,o);for(f in o[E].methods)o[b].methods[f]||(u.unimplemented+=1);for(f in o[E].staticMethods)o[b].staticMethods[f]||(u.unimplemented+=1);return o}var y=p("AbstractClassWrapper"),b="$class_"+y,w="$interface_"+y,E="$abstract_"+y,S="$bound_"+y,x={};return c(),x.declare=function(e,t,n){return g.declare.call(L,e,t,n)},x}),define("dejavu/Interface",["mout/lang/isObject","mout/lang/isArray","mout/lang/isString","mout/function/bind","mout/array/intersection","mout/array/unique","mout/array/compact","mout/object/keys","./lib/checkKeywords","./lib/testKeywords","./lib/functionMeta","./lib/isFunctionEmpty","./lib/isFunctionCompatible","./lib/checkObjectPrototype","./lib/obfuscateProperty","./lib/randomAccessor","./lib/isImmutable","./lib/hasDefineProperty","./lib/mixIn","mout/lang/isFunction","mout/object/hasOwn","mout/lang/toArray"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){function k(e){var t,n;for(t in this[N].methods){n=this[N].methods[t];if(!e[T].methods[t])throw new Error('Class "'+e.prototype.$name+'" does not implement interface "'+this.prototype.$name+'" correctly, method "'+t+'" was not found.');if(!p(e[T].methods[t],n))throw new Error('Method "'+t+"("+e[T].methods[t].signature+')" defined in class "'+e.prototype.$name+'" is not compatible with the one found in interface "'+this.prototype.$name+'": "'+t+"("+n.signature+')".')}for(t in this[N].staticMethods){n=this[N].staticMethods[t];if(!e[T].staticMethods[t])throw new Error('Class "'+e.prototype.$name+'" does not implement interface "'+this.prototype.$name+'" correctly, static method "'+t+'" was not found.');if(!p(e[T].staticMethods[t],n))throw new Error('Static method "'+t+"("+e[T].staticMethods[t].signature+')" defined in class "'+e.prototype.$name+'" is not compatible with the one found in interface "'+this.prototype.$name+'": "'+t+"("+n.signature+')".')}}function L(e,n,r,i){var s,o=i&&i.isStatic,u;if(!w(n)||n[N]||n[T])throw new Error('Member "'+e+'" found in interface "'+r.prototype.$name+'" is not a function.');if(e.charAt(0)==="_")throw new Error('Interface "'+r.prototype.$name+'" contains an unallowed non public method: "'+e+'".');if(!h(n))throw new Error((o?"Static method":"Method")+' "'+e+'" must be anonymous and contain no implementation in interface "'+r.prototype.$name+'".');s=c(n,e);if(s===null)throw new Error((o?"Static method":"Method")+' "'+e+'" contains optional arguments before mandatory ones in interface "'+r.prototype.$name+'".');u=o?r[N].staticMethods:r[N].methods;if(t(u[e])&&!p(s,u[e]))throw new Error((o?"Static method":"Method")+' "'+e+"("+s.signature+')" defined in interface "'+r.prototype.$name+'" overrides its ancestor but it is not compatible with its signature: "'+e+"("+u[e].signature+')".');u[e]=s}function A(e,t,n){y?Object.defineProperty(n,e,{get:function(){return t},set:function(){throw new Error('Cannot change value of constant property "'+e+'" of interface "'+this.prototype.$name+'".')},configurable:!1,enumerable:!0}):n[e]=t}function O(e,t,n){var r;if(e.charAt(0)==="_")throw new Error('Interface "'+n.prototype.$name+'" contains an unallowed non public method: "'+e+'".');if(!g(t))throw new Error('Value for constant property "'+e+'" defined in interface "'+n.prototype.$name+'" must be a primitive type.');r=n[N].constants;if(r[e])throw new Error('Cannot override constant property "'+e+'" in interface "'+n.prototype.$name+'".');r[e]=!0,A(e,t,n)}function M(e){if(e.$extends)throw new Error("Object passed cannot contain an $extends property.");return e.$extends=this,C.declare(e)}function _(e){if(!t(e))throw new Error("Expected interface definition to be an object with the interface members.");if(E(e,"$name")){if(!r(e.$name))throw new Error("Interface name must be a string.");if(/\s+/.test(e.$name))throw new Error("Interface name cannot have spaces.")}else e.$name="Unnamed";f(e);var c,h,d,m,g,y,x={},C,_,D,P=function(){throw new Error("Interfaces cannot be instantiated.")};v(P,N,{parents:[],methods:{},staticMethods:{},constants:{},check:i(k,P)}),P.prototype.$name=e.$name;if(E(e,"$extends")){c=S(e.$extends),d=c.length;if(!d&&!n(e.$extends))throw new Error('$extends of "'+e.$name+'" seems to point to an nonexistent interface.');if(d!==o(c).length&&u(c).length===d)throw new Error('There are duplicate entries defined in $extends of "'+e.$name+'".');for(d-=1;d>=0;d-=1){h=c[d];if(!w(h)||!h[N])throw new Error("Specified interface in $extends at index "+d+' of "'+e.$name+'" is not a valid interface.');y=s(a(P[N].methods),a(h[N].methods)),m=y.length;if(m)for(m-=1;m>=0;m-=1)if(!p(P[N].methods[y[m]],h[N].methods[y[m]])&&!p(h[N].methods[y[m]],P[N].methods[y[m]]))throw new Error('Interface "'+e.$name+'" is inheriting method "'+y[m]+'" from different parents with incompatible signatures.');b(P[N].methods,h[N].methods),y=s(a(P[N].staticMethods),a(h[N].staticMethods)),m=y.length;if(m)for(m-=1;m>=0;m-=1)if(!p(P[N].staticMethods[y[m]],h[N].staticMethods[y[m]])&&!p(h[N].staticMethods[y[m]],P[N].staticMethods[y[m]]))throw new Error('Interface "'+e.$name+'" is inheriting static method "'+y[m]+'" from different parents with incompatible signatures.');b(P[N].staticMethods,h[N].staticMethods);for(m in h[N].constants)if(P[N].constants[m]){if(P[m]!==h[m])throw new Error('Interface "'+e.$name+'" is inheriting constant property "'+m+'" from different parents with different values.')}else P[N].constants[m]=h[N].constants[m],A(m,h[m],P);P[N].parents.push(h)}delete e.$extends}if(E(e,"initialize"))throw new Error('Interface "'+e.$name+"\" can't define the initialize method.");if(E(e,"$constants")){if(!t(e.$constants))throw new Error('$constants definition of interface "'+e.$name+'" must be an object.');f(e.$constants,"statics"),D=l(e.$constants);if(D)throw new Error('$constants of interface "'+P.prototype.$name+'" contains an unallowed keyword: "'+D+'".');if(E(e,"$statics")){_=s(a(e.$constants),a(e.$statics));if(_.length)throw new Error('There are members defined in interface "'+e.$name+'" with the same name but with different modifiers: "'+_.join('", ')+'".')}for(d in e.$constants)O(d,e.$constants[d],P);delete e.$constants}if(E(e,"$statics")){if(!t(e.$statics))throw new Error('$statics definition of interface "'+e.$name+'" must be an object.');f(e.$statics,"statics"),D=l(e.$statics);if(D)throw new Error('$statics of interface "'+P.prototype.$name+'" contains an unallowed keyword: "'+D+'".');x.isStatic=!0;for(d in e.$statics){g=e.$statics[d];if(!w(g)||g[N]||g[T])throw new Error('Static member "'+d+'" found in interface "'+e.$name+'" is not a function.');L(d,g,P,x)}delete x.isStatic,delete e.$statics}C=e.$name,delete e.$name,D=l(e,["$extends","$statics","$constants"]);if(D)throw new Error('$statics of interface "'+P.prototype.$name+'" contains an unallowed keyword: "'+D+'".');for(d in e)L(d,e[d],P);return e.$name=C,P.extend=M,P}var x=m("InterfaceWrapper"),T="$class_"+x,N="$interface_"+x,C={};return d(),C.declare=_,C}),define("dejavu/FinalClass",["./Class","./lib/randomAccessor","./lib/checkObjectPrototype"],function(t,n,r){function u(e,n){var r=t.$create(e,n);return r[s].finalClass=!0,r}r();var i=n("FinalClassWrapper"),s="$class_"+i,o={};return o.declare=function(e,n,r){return t.declare.call(u,e,n,r)},o}),define("dejavu/instanceOf",["mout/lang/isFunction","./lib/randomAccessor"],function(t,n){function o(e,t){var n,r=e[s].parents;for(n=r.length-1;n>=0;n-=1){if(r[n]===t)return!0;if(o(e,r[n]))return!0}return!1}function u(e,t){var n,r=e.$static[i].interfaces;for(n=r.length-1;n>=0;n-=1)if(r[n]===t||o(r[n],t))return!0;return!1}function a(e,n){return t(n)?e instanceof n?!0:e&&e.$static&&e.$static[i]&&n&&n[s]?u(e,n):!1:!1}var r=n("instanceOfWrapper"),i="$class_"+r,s="$interface_"+r;return a}),define("dejavu/main",["./Class","./AbstractClass","./Interface","./FinalClass","./instanceOf","./options"],function(e,t,n,r,i,s){var o={};return o.Class=e,o.AbstractClass=t,o.Interface=n,o.FinalClass=r,o.instanceOf=i,o.options=s,o.mode="strict",o}),define("dejavu",["dejavu/main"],function(e){return e}),define("app/event/Event",["dejavu"],function(e){var t=e.Class.declare({$name:"Event",_controlId:null,_value:null,_type:null,$constants:{TYPE_VALUE_CHANGED:1,TYPE_CHECKED_CHANGED:2},getControlId:function(){return this._controlId},setControlId:function(e){return this._controlId=e,this},getValue:function(){return this._value},setValue:function(e){return this._value=e,this},getType:function(){return this._type},setType:function(e){return this._type=e,this},initialize:function(e,t,n){this._controlId=e,this._value=t,this._type=n}});return t}),define("app/event/CustomEvent",["dejavu"],function(e){var t=e.Class.declare({$name:"CustomEvent",_listeners:null,initialize:function(){this._listeners={}},addListener:function(e,t){typeof this._listeners[e]=="undefined"&&(this._listeners[e]=[]),this._listeners[e].push(t)},fire:function(e,t,n){if(this._listeners[e]instanceof Array){var r=this._listeners[e];for(var i=0,s=r.length;i<s;i++)r[i].call(t,n)}}});return t}),define("app/utils/MousePosition",["dejavu"],function(e){var t=e.Class.declare({$name:"MousePosition",_x:null,_y:null,setX:function(e){this._x=e},getX:function(){return this._x},setY:function(e){this._y=e},getY:function(){return this._y},initialize:function(e,t){this._x=e,this._y=t}});return t});var Kinetic={};!function(){Kinetic={version:"5.0.1",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var e=navigator.userAgent.toLowerCase(),t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}(),Filters:{},Node:function(e){this._init(e)},Shape:function(e){this.__init(e)},Container:function(e){this.__init(e)},Stage:function(e){this.___init(e)},Layer:function(e){this.___init(e)},Group:function(e){this.___init(e)},isDragging:function(){var e=Kinetic.DD;return e?e.isDragging:!1},isDragReady:function(){var e=Kinetic.DD;return e?!!e.node:!1},_addId:function(e,t){void 0!==t&&(this.ids[t]=e)},_removeId:function(e){void 0!==e&&delete this.ids[e]},_addName:function(e,t){void 0!==t&&(void 0===this.names[t]&&(this.names[t]=[]),this.names[t].push(e))},_removeName:function(e,t){if(void 0!==e){var n=this.names[e];if(void 0!==n){for(var r=0;r<n.length;r++){var i=n[r];i._id===t&&n.splice(r,1)}0===n.length&&delete this.names[e]}}}}}(),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("kinetic",t):e.returnExports=t()}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),t=e.length,n=0;for(this.length=t;t>n;n++)this[n]=e[n];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},Kinetic.Collection.prototype.toArray=function(){var e,t=[],n=this.length;for(e=0;n>e;e++)t.push(this[e]);return t},Kinetic.Collection.toCollection=function(e){var t,n=new Kinetic.Collection,r=e.length;for(t=0;r>t;t++)n.push(e[t]);return n},Kinetic.Collection.mapMethods=function(e){var t,n=e.prototype;for(t in n)!function(e){Kinetic.Collection.prototype[e]=function(){var t,n=this.length;for(args=[].slice.call(arguments),t=0;n>t;t++)this[t][e].apply(this[t],args);return this}}(t)},Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t},scale:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,s=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(e,t){var n=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,i=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=s},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o},getMatrix:function(){return this.m},setAbsolutePosition:function(e,t){var n=this.m[0],r=this.m[1],i=this.m[2],s=this.m[3],o=this.m[4],u=this.m[5],a=(n*(t-u)-r*(e-o))/(n*s-r*i),f=(e-o-i*a)/n;this.translate(f,a)}};var e="canvas",t="2d",n="[object Array]",r="[object Number]",i="[object String]",s=Math.PI/180,o=180/Math.PI,u="#",a="",f="0",l="Kinetic warning: ",c="Kinetic error: ",h="rgb(",p={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(e){return!!e&&1==e.nodeType},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return Object.prototype.toString.call(e)==n},_isNumber:function(e){return Object.prototype.toString.call(e)==r},_isString:function(e){return Object.prototype.toString.call(e)==i},_hasMethods:function(e){var t,n=[];for(t in e)this._isFunction(e[t])&&n.push(t);return n.length>0},_isInDocument:function(e){for(;e=e.parentNode;)if(e==document)return!0;return!1},_simplifyArray:function(e){var t,n,r=[],i=e.length,s=Kinetic.Util;for(t=0;i>t;t++)n=e[t],s._isNumber(n)?n=Math.round(1e3*n)/1e3:s._isString(n)||(n=n.toString()),r.push(n);return r},_getImage:function(n,r){var i,s;n?this._isElement(n)?r(n):this._isString(n)?(i=new Image,i.onload=function(){r(i)},i.src=n):n.data?(s=document.createElement(e),s.width=n.width,s.height=n.height,_context=s.getContext(t),_context.putImageData(n,0,0),this._getImage(s.toDataURL(),r)):r(null):r(null)},_getRGBAString:function(e){var t=e.red||0,n=e.green||0,r=e.blue||0,i=e.alpha||1;return["rgba(",t,",",n,",",r,",",i,")"].join(a)},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace(u,a);var t=parseInt(e,16);return{r:255&t>>16,g:255&t>>8,b:255&t}},getRandomColor:function(){for(var e=(16777215*Math.random()<<0).toString(16);e.length<6;)e=f+e;return u+e},get:function(e,t){return void 0===e?t:e},getRGB:function(e){var t;return e in p?(t=p[e],{r:t[0],g:t[1],b:t[2]}):e[0]===u?this._hexToRgb(e.substring(1)):e.substr(0,4)===h?(t=d.exec(e.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},_merge:function(e,t){var n=this._clone(t);for(var r in e)n[r]=this._isObject(e[r])?this._merge(e[r],n[r]):e[r];return n},cloneObject:function(e){var t={};for(var n in e)t[n]=this._isObject(e[n])?this._clone(e[n]):e[n];return t},cloneArray:function(e){return e.slice(0)},_degToRad:function(e){return e*s},_radToDeg:function(e){return e*o},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},error:function(e){throw new Error(c+e)},warn:function(e){window.console&&console.warn&&console.warn(l+e)},extend:function(e,t){for(var n in t.prototype)n in e.prototype||(e.prototype[n]=t.prototype[n])},addMethods:function(e,t){var n;for(n in t)e.prototype[n]=t[n]},_getControlPoints:function(e,t,n,r,i,s,o){var u=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),a=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=o*u/(u+a),l=o*a/(u+a),c=n-f*(i-e),h=r-f*(s-t),p=n+l*(i-e),d=r+l*(s-t);return[c,h,p,d]},_expandPoints:function(e,t){var n,r,i=e.length,s=[];for(n=2;i-2>n;n+=2)r=Kinetic.Util._getControlPoints(e[n-2],e[n-1],e[n],e[n+1],e[n+2],e[n+3],t),s.push(r[0]),s.push(r[1]),s.push(e[n]),s.push(e[n+1]),s.push(r[2]),s.push(r[3]);return s},_removeLastLetter:function(e){return e.substring(0,e.length-1)}}}(),function(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;Kinetic.Canvas=function(e){this.init(e)},Kinetic.Canvas.prototype={init:function(e){e=e||{};var t=e.pixelRatio||Kinetic.pixelRatio||i;this.pixelRatio=t,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(e){this.pixelRatio=e,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px"},setHeight:function(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,t){this.setWidth(e),this.setHeight(t)},toDataURL:function(e,t){try{return this._canvas.toDataURL(e,t)}catch(n){try{return this._canvas.toDataURL()}catch(r){return Kinetic.Util.warn("Unable to get data URL. "+r.message),""}}}},Kinetic.SceneCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.SceneContext(this),this.setSize(t,n)},Kinetic.SceneCanvas.prototype={setWidth:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,e),n.scale(t,t)},setHeight:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,e),n.scale(t,t)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.HitContext(this),this.setSize(t,n)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var e=",",t="(",n=")",r="([",i="])",s=";",o="()",u="=",a=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(e){this.init(e)},Kinetic.Context.prototype={init:function(e){this.canvas=e,this._context=e._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(e){e.getFillEnabled()&&this._fill(e)},strokeShape:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStrokeShape:function(e){var t=e.getFillEnabled();t&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e)},getTrace:function(a){var l,p,v,m,y=this.traceArr,w=y.length,E="";for(l=0;w>l;l++)p=y[l],v=p.method,v?(m=p.args,E+=v,E+=a?o:Kinetic.Util._isArray(m[0])?r+m.join(e)+i:t+m.join(e)+n):(E+=p.property,a||(E+=u+p.val)),E+=s;return E},clearTrace:function(){this.traceArr=[]},_trace:function(e){var t,n=this.traceArr;n.push(e),t=n.length,t>=Kinetic.traceArrMax&&n.shift()},reset:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)},getCanvas:function(){return this.canvas},clear:function(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth(),t.getHeight())},_applyLineCap:function(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();1!==t&&this.setAttr("globalAlpha",t)},_applyLineJoin:function(e){var t=e.getLineJoin();t&&this.setAttr("lineJoin",t)},_applyTransform:function(e){var t,n=e.getTransformsEnabled();"all"===n?(t=e.getAbsoluteTransform().getMatrix(),this.transform(t[0],t[1],t[2],t[3],t[4],t[5])):"position"===n&&this.translate(e.getX(),e.getY())},setAttr:function(e,t){this._context[e]=t},arc:function(){var e=arguments;this._context.arc(e[0],e[1],e[2],e[3],e[4],e[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var e=arguments;this._context.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])},clearRect:function(){var e=arguments;this._context.clearRect(e[0],e[1],e[2],e[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var e=arguments;return 2===e.length?this._context.createImageData(e[0],e[1]):1===e.length?this._context.createImageData(e[0]):void 0},createLinearGradient:function(){var e=arguments;return this._context.createLinearGradient(e[0],e[1],e[2],e[3])},createPattern:function(){var e=arguments;return this._context.createPattern(e[0],e[1])},createRadialGradient:function(){var e=arguments;return this._context.createRadialGradient(e[0],e[1],e[2],e[3],e[4],e[5])},drawImage:function(){var e=arguments,t=this._context;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fill:function(){this._context.fill()},fillText:function(){var e=arguments;this._context.fillText(e[0],e[1],e[2])},getImageData:function(){var e=arguments;return this._context.getImageData(e[0],e[1],e[2],e[3])},lineTo:function(){var e=arguments;this._context.lineTo(e[0],e[1])},moveTo:function(){var e=arguments;this._context.moveTo(e[0],e[1])},rect:function(){var e=arguments;this._context.rect(e[0],e[1],e[2],e[3])},putImageData:function(){var e=arguments;this._context.putImageData(e[0],e[1],e[2])},quadraticCurveTo:function(){var e=arguments;this._context.quadraticCurveTo(e[0],e[1],e[2],e[3])},restore:function(){this._context.restore()},rotate:function(){var e=arguments;this._context.rotate(e[0])},save:function(){this._context.save()},scale:function(){var e=arguments;this._context.scale(e[0],e[1])},setLineDash:function(){var e=arguments,t=this._context;this._context.setLineDash?t.setLineDash(e[0]):"mozDash"in t?t.mozDash=e[0]:"webkitLineDash"in t&&(t.webkitLineDash=e[0])},setTransform:function(){var e=arguments;this._context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},stroke:function(){this._context.stroke()},strokeText:function(){var e=arguments;this._context.strokeText(e[0],e[1],e[2])},transform:function(){var e=arguments;this._context.transform(e[0],e[1],e[2],e[3],e[4],e[5])},translate:function(){var e=arguments;this._context.translate(e[0],e[1])},_enableTrace:function(){var e,t,n=this,r=a.length,i=Kinetic.Util._simplifyArray,s=this.setAttr;for(e=0;r>e;e++)!function(e){var r,s=n[e];n[e]=function(){return t=i(Array.prototype.slice.call(arguments,0)),r=s.apply(n,arguments),n._trace({method:e,args:t}),r}}(a[e]);n.setAttr=function(){s.apply(n,arguments),n._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(e){Kinetic.Context.call(this,e)},Kinetic.SceneContext.prototype={_fillColor:function(e){var t=e.fill()||Kinetic.Util._getRGBAString({red:e.fillRed(),green:e.fillGreen(),blue:e.fillBlue(),alpha:e.fillAlpha()});this.setAttr("fillStyle",t),e._fillFunc(this)},_fillPattern:function(e){var t=e.getFillPatternImage(),n=e.getFillPatternX(),r=e.getFillPatternY(),i=e.getFillPatternScale(),s=e.getFillPatternRotation(),o=e.getFillPatternOffset(),u=e.getFillPatternRepeat();(n||r)&&this.translate(n||0,r||0),s&&this.rotate(s),i&&this.scale(i.x,i.y),o&&this.translate(-1*o.x,-1*o.y),this.setAttr("fillStyle",this.createPattern(t,u||"repeat")),this.fill()},_fillLinearGradient:function(e){var t=e.getFillLinearGradientStartPoint(),n=e.getFillLinearGradientEndPoint(),r=e.getFillLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(var s=0;s<r.length;s+=2)i.addColorStop(r[s],r[s+1]);this.setAttr("fillStyle",i),this.fill()}},_fillRadialGradient:function(e){for(var t=e.getFillRadialGradientStartPoint(),n=e.getFillRadialGradientEndPoint(),r=e.getFillRadialGradientStartRadius(),i=e.getFillRadialGradientEndRadius(),s=e.getFillRadialGradientColorStops(),o=this.createRadialGradient(t.x,t.y,r,n.x,n.y,i),u=0;u<s.length;u+=2)o.addColorStop(s[u],s[u+1]);this.setAttr("fillStyle",o),this.fill()},_fill:function(e){var t=e.fill()||e.fillRed()||e.fillGreen()||e.fillBlue(),n=e.getFillPatternImage(),r=e.getFillLinearGradientColorStops(),i=e.getFillRadialGradientColorStops(),s=e.getFillPriority();t&&"color"===s?this._fillColor(e):n&&"pattern"===s?this._fillPattern(e):r&&"linear-gradient"===s?this._fillLinearGradient(e):i&&"radial-gradient"===s?this._fillRadialGradient(e):t?this._fillColor(e):n?this._fillPattern(e):r?this._fillLinearGradient(e):i&&this._fillRadialGradient(e)},_stroke:function(e){var t=e.dash(),n=e.getStrokeScaleEnabled();e.hasStroke()&&(n||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(e),t&&e.dashEnabled()&&this.setLineDash(t),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.stroke()||Kinetic.Util._getRGBAString({red:e.strokeRed(),green:e.strokeGreen(),blue:e.strokeBlue(),alpha:e.strokeAlpha()})),e._strokeFunc(this),n||this.restore())},_applyShadow:function(e){var t=Kinetic.Util,n=e.getAbsoluteOpacity(),r=t.get(e.getShadowColor(),"black"),i=t.get(e.getShadowBlur(),5),s=t.get(e.getShadowOpacity(),0),o=t.get(e.getShadowOffset(),{x:0,y:0});s&&this.setAttr("globalAlpha",s*n),this.setAttr("shadowColor",r),this.setAttr("shadowBlur",i),this.setAttr("shadowOffsetX",o.x),this.setAttr("shadowOffsetY",o.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(e){Kinetic.Context.call(this,e)},Kinetic.HitContext.prototype={_fill:function(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()},_stroke:function(e){e.hasStroke()&&(this._applyLineCap(e),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var e="get",t="set";Kinetic.Factory={addGetterSetter:function(e,t,n,r,i){this.addGetter(e,t,n),this.addSetter(e,t,r,i),this.addOverloadedGetterSetter(e,t)},addGetter:function(t,n,r){var i=e+Kinetic.Util._capitalize(n);t.prototype[i]=function(){var e=this.attrs[n];return void 0===e?r:e}},addSetter:function(e,n,r,i){var s=t+Kinetic.Util._capitalize(n);e.prototype[s]=function(e){return r&&(e=r.call(this,e)),this._setAttr(n,e),i&&i.call(this),this}},addComponentsGetterSetter:function(n,r,i,s,o){var u,f,l=i.length,c=Kinetic.Util._capitalize,h=e+c(r),p=t+c(r);n.prototype[h]=function(){var e={};for(u=0;l>u;u++)f=i[u],e[f]=this.getAttr(r+c(f));return e},n.prototype[p]=function(e){var t,n=this.attrs[r];s&&(e=s.call(this,e));for(t in e)this._setAttr(r+c(t),e[t]);return this._fireChangeEvent(r,n,e),o&&o.call(this),this},this.addOverloadedGetterSetter(n,r)},addOverloadedGetterSetter:function(n,r){var i=Kinetic.Util._capitalize(r),s=t+i,o=e+i;n.prototype[r]=function(){return arguments.length?(this[s](arguments[0]),this):this[o]()}},backCompat:function(e,t){var n;for(n in t)e.prototype[n]=e.prototype[t[n]]},afterSetFilter:function(){this._filterUpToDate=!1}},Kinetic.Validators={RGBComponent:function(e){return e>255?255:0>e?0:Math.round(e)},alphaComponent:function(e){return e>1?1:1e-4>e?1e-4:e}}}(),function(){var e="absoluteOpacity",t="absoluteTransform",n="before",r="Change",i="children",s=".",o="",u="get",a="id",f="kinetic",l="listening",c="mouseenter",h="mouseleave",p="name",d="set",v="Shape",m=" ",g="stage",y="transform",b="Stage",w="visible",E=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(m);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(n){var r=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(n),this.on(E,function(){this._clearCache(y),r._clearSelfAndDescendantCache(t)}),this.on("visibleChange.kinetic",function(){r._clearSelfAndDescendantCache(w)}),this.on("listeningChange.kinetic",function(){r._clearSelfAndDescendantCache(l)}),this.on("opacityChange.kinetic",function(){r._clearSelfAndDescendantCache(e)})},_clearCache:function(e){e?delete this._cache[e]:this._cache={}},_getCache:function(e,t){var n=this._cache[e];return void 0===n&&(this._cache[e]=t.call(this)),this._cache[e]},_clearSelfAndDescendantCache:function(e){this._clearCache(e),this.children&&this.getChildren().each(function(t){t._clearSelfAndDescendantCache(e)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(e){var t,n=e||{},r=n.x||0,i=n.y||0,s=n.width||this.width(),o=n.height||this.height(),u=n.drawBorder||!1,a=new Kinetic.SceneCanvas({pixelRatio:1,width:s,height:o}),f=new Kinetic.SceneCanvas({pixelRatio:1,width:s,height:o}),l=new Kinetic.HitCanvas({width:s,height:o}),c=this.transformsEnabled(),h=this.x(),p=this.y();return this.clearCache(),this.transformsEnabled("position"),this.x(-1*r),this.y(-1*i),this.drawScene(a),this.drawHit(l),u&&(t=a.getContext(),t.save(),t.beginPath(),t.rect(0,0,s,o),t.closePath(),t.setAttr("strokeStyle","red"),t.setAttr("lineWidth",5),t.stroke(),t.restore()),this.x(h),this.y(p),this.transformsEnabled(c),this._cache.canvas={scene:a,filter:f,hit:l},this},_drawCachedSceneCanvas:function(e){e.save(),e._applyTransform(this),e.drawImage(this._getCachedSceneCanvas()._canvas,0,0),e.restore()},_getCachedSceneCanvas:function(){var e,t,n,r,i=this.filters(),s=this._cache.canvas,o=s.scene,u=s.filter,a=u.getContext();if(i){if(!this._filterUpToDate){try{for(e=i.length,a.clear(),a.drawImage(o._canvas,0,0),t=a.getImageData(0,0,u.getWidth(),u.getHeight()),n=0;e>n;n++)r=i[n],r.call(this,t),a.putImageData(t,0,0)}catch(f){Kinetic.Util.warn("Unable to apply filter. "+f.message)}this._filterUpToDate=!0}return u}return o},_drawCachedHitCanvas:function(e){var t=this._cache.canvas,n=t.hit;e.save(),e._applyTransform(this),e.drawImage(n._canvas,0,0),e.restore()},on:function(e,t){var n,r,i,u,a,f=e.split(m),l=f.length;for(n=0;l>n;n++)r=f[n],i=r.split(s),u=i[0],a=i[1]||o,this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:a,handler:t});return this},off:function(e){var t,n,r,i,o,u,a=e.split(m),f=a.length;for(t=0;f>t;t++)if(r=a[t],i=r.split(s),o=i[0],u=i[1],o)this.eventListeners[o]&&this._off(o,u);else for(n in this.eventListeners)this._off(n,u);return this},remove:function(){var n=this.getParent();return n&&n.children&&(n.children.splice(this.index,1),n._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(g),this._clearSelfAndDescendantCache(t),this._clearSelfAndDescendantCache(w),this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(e),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(e){var t=u+Kinetic.Util._capitalize(e);return Kinetic.Util._isFunction(this[t])?this[t]():this.attrs[e]},getAncestors:function(){for(var e=this.getParent(),t=new Kinetic.Collection;e;)t.push(e),e=e.getParent();return t},getAttrs:function(){return this.attrs||{}},setAttrs:function(e){var t,n;if(e)for(t in e)t===i||(n=d+Kinetic.Util._capitalize(t),Kinetic.Util._isFunction(this[n])?this[n](e[t]):this._setAttr(t,e[t]));return this},isListening:function(){return this._getCache(l,this._isListening)},_isListening:function(){var e=this.getListening(),t=this.getParent();return"inherit"===e?t?t.isListening():!0:e},isVisible:function(){return this._getCache(w,this._isVisible)},_isVisible:function(){var e=this.getVisible(),t=this.getParent();return"inherit"===e?t?t.isVisible():!0:e},shouldDrawHit:function(){var e=this.getLayer();return e&&e.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function e(a){for(t=[],n=a.length,r=0;n>r;r++)i=a[r],u++,i.nodeType!==v&&(t=t.concat(i.getChildren().toArray())),i._id===o._id&&(r=n);t.length>0&&t[0].getDepth()<=s&&e(t)}var t,n,r,i,s=this.getDepth(),o=this,u=0;return o.nodeType!==b&&e(o.getStage().getChildren()),u},getDepth:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},setPosition:function(e){return this.setX(e.x),this.setY(e.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform().getMatrix(),t=new Kinetic.Transform,n=this.offset();return t.m=e.slice(),t.translate(n.x,n.y),t.getTranslation()},setAbsolutePosition:function(e){var t,n=this._clearTransform();return this.attrs.x=n.x,this.attrs.y=n.y,delete n.x,delete n.y,t=this.getAbsoluteTransform(),t.invert(),t.translate(e.x,e.y),e={x:this.attrs.x+t.getTranslation().x,y:this.attrs.y+t.getTranslation().y},this.setPosition({x:e.x,y:e.y}),this._setTransform(n),this},_setTransform:function(e){var n;for(n in e)this.attrs[n]=e[n];this._clearCache(y),this._clearSelfAndDescendantCache(t)},_clearTransform:function(){var e={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(y),this._clearSelfAndDescendantCache(t),e},move:function(e){var t=e.x,n=e.y,r=this.getX(),i=this.getY();return void 0!==t&&(r+=t),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this},_eachAncestorReverse:function(e,t){var n,r,i=[],s=this.getParent();for(t&&i.unshift(this);s;)i.unshift(s),s=s.parent;for(n=i.length,r=0;n>r;r++)e(i[r])},rotate:function(e){return this.setRotation(this.getRotation()+e),this},moveToTop:function(){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var e=this.index,t=this.parent.getChildren().length;return t-1>e?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(e){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(e,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var e=this.getOpacity();return this.getParent()&&(e*=this.getParent().getAbsoluteOpacity()),e},moveTo:function(e){return Kinetic.Node.prototype.remove.call(this),e.add(this),this},toObject:function(){var e,t,n,r,i=Kinetic.Util,s={},o=this.getAttrs();s.attrs={};for(e in o)t=o[e],i._isFunction(t)||i._isElement(t)||i._isObject(t)&&i._hasMethods(t)||(n=this[e],delete o[e],r=n?n.call(this):null,o[e]=t,r!==t&&(s.attrs[e]=t));return s.className=this.getClassName(),s},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var e=this.getParent();return e?e.getLayer():null},getStage:function(){return this._getCache(g,this._getStage)},_getStage:function(){var e=this.getParent();return e?e.getStage():void 0},fire:function(e,t,n){return n?this._fireAndBubble(e,t||{}):this._fire(e,t||{}),this},getAbsoluteTransform:function(){return this._getCache(t,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var e,t,n=new Kinetic.Transform;return this._eachAncestorReverse(function(r){e=r.transformsEnabled(),t=r.getTransform(),"all"===e?n.multiply(t):"position"===e&&n.translate(r.x(),r.y())},!0),n},getTransform:function(){return this._getCache(y,this._getTransform)},_getTransform:function(){var e=new Kinetic.Transform,t=this.getX(),n=this.getY(),r=this.getRotation()*Math.PI/180,i=this.getScaleX(),s=this.getScaleY(),o=this.getSkewX(),u=this.getSkewY(),a=this.getOffsetX(),f=this.getOffsetY();return(0!==t||0!==n)&&e.translate(t,n),0!==r&&e.rotate(r),(0!==o||0!==u)&&e.skew(o,u),(1!==i||1!==s)&&e.scale(i,s),(0!==a||0!==f)&&e.translate(-1*a,-1*f),e},clone:function(e){var t,n,r,i,s,o=this.getClassName(),u=new Kinetic[o](this.attrs);for(t in this.eventListeners)for(n=this.eventListeners[t],r=n.length,i=0;r>i;i++)s=n[i],s.name.indexOf(f)<0&&(u.eventListeners[t]||(u.eventListeners[t]=[]),u.eventListeners[t].push(s));return u.setAttrs(e),u},toDataURL:function(e){e=e||{};var t=e.mimeType||null,n=e.quality||null,r=this.getStage(),i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth()||(r?r.getWidth():0),height:e.height||this.getHeight()||(r?r.getHeight():0),pixelRatio:1}),u=o.getContext();return u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(o),u.restore(),o.toDataURL(t,n)},toImage:function(e){Kinetic.Util._getImage(this.toDataURL(e),function(t){e.callback(t)})},setSize:function(e){return this.setWidth(e.width),this.setHeight(e.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(e){return this.nodeType===e?[this]:[]},_off:function(e,t){var n,r,i=this.eventListeners[e];for(n=0;n<i.length;n++)if(r=i[n].name,!("kinetic"===r&&"kinetic"!==t||t&&r!==t)){if(i.splice(n,1),0===i.length){delete this.eventListeners[e];break}n--}},_fireBeforeChangeEvent:function(e,t,i){this._fire([n,Kinetic.Util._capitalize(e),r].join(o),{oldVal:t,newVal:i})},_fireChangeEvent:function(e,t,n){this._fire(e+r,{oldVal:t,newVal:n})},setId:function(e){var t=this.getId();return Kinetic._removeId(t),Kinetic._addId(this,e),this._setAttr(a,e),this},setName:function(e){var t=this.getName();return Kinetic._removeName(t,this._id),Kinetic._addName(this,e),this._setAttr(p,e),this},setAttr:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],r=d+Kinetic.Util._capitalize(t),i=this[r];return Kinetic.Util._isFunction(i)?i.call(this,n):this._setAttr(t,n),this},_setAttr:function(e,t){var n;void 0!==t&&(n=this.attrs[e],this.attrs[e]=t,this._fireChangeEvent(e,n,t))},_setComponentAttr:function(e,t,n){var r;void 0!==n&&(r=this.attrs[e],r||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=n,this._fireChangeEvent(e,r,n))},_fireAndBubble:function(e,t,n){var r=!0;t&&this.nodeType===v&&(t.targetNode=this),e===c&&n&&this._id===n._id?r=!1:e===h&&n&&this._id===n._id&&(r=!1),r&&(this._fire(e,t),t&&!t.cancelBubble&&this.parent&&(n&&n.parent?this._fireAndBubble.call(this.parent,e,t,n.parent):this._fireAndBubble.call(this.parent,e,t)))},_fire:function(e,t){var n,r=this.eventListeners[e];if(r)for(n=0;n<r.length;n++)r[n].handler.call(this,t)},draw:function(){return this.drawScene(),this.drawHit(),this}}),Kinetic.Node.create=function(e,t){return this._createNode(JSON.parse(e),t)},Kinetic.Node._createNode=function(e,t){var n,r,i,s=Kinetic.Node.prototype.getClassName.call(e),o=e.children;if(t&&(e.attrs.container=t),n=new Kinetic[s](e.attrs),o)for(r=o.length,i=0;r>i;i++)n.add(this._createNode(o[i]));return n},Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0),Kinetic.Factory.addSetter(Kinetic.Node,"width",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(e){return this._filterUpToDate=!1,e}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all"),Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Kinetic.Collection.mapMethods(Kinetic.Node)}(),function(){Kinetic.Filters.Grayscale=function(e){var t,n,r=e.data,i=r.length;for(t=0;i>t;t+=4)n=.34*r[t]+.5*r[t+1]+.16*r[t+2],r[t]=n,r[t+1]=n,r[t+2]=n}}(),function(){Kinetic.Filters.Brighten=function(e){var t,n=255*this.brightness(),r=e.data,i=r.length;for(t=0;i>t;t+=4)r[t]+=n,r[t+1]+=n,r[t+2]+=n},Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Invert=function(e){var t,n=e.data,r=n.length;for(t=0;r>t;t+=4)n[t]=255-n[t],n[t+1]=255-n[t+1],n[t+2]=255-n[t+2]}}(),function(){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function t(t,i){var s,o,u,f,l,h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=t.data,D=t.width,P=t.height,H=i+i+1,B=D-1,j=P-1,F=i+1,I=F*(F+1)/2,q=new e,R=null,U=q,z=null,W=null,X=n[i],V=r[i];for(u=1;H>u;u++)U=U.next=new e,u==F&&(R=U);for(U.next=q,p=h=0,o=0;P>o;o++){for(x=T=N=C=v=m=g=y=0,b=F*(k=_[h]),w=F*(L=_[h+1]),E=F*(A=_[h+2]),S=F*(O=_[h+3]),v+=I*k,m+=I*L,g+=I*A,y+=I*O,U=q,u=0;F>u;u++)U.r=k,U.g=L,U.b=A,U.a=O,U=U.next;for(u=1;F>u;u++)f=h+((u>B?B:u)<<2),v+=(U.r=k=_[f])*(M=F-u),m+=(U.g=L=_[f+1])*M,g+=(U.b=A=_[f+2])*M,y+=(U.a=O=_[f+3])*M,x+=k,T+=L,N+=A,C+=O,U=U.next;for(z=q,W=R,s=0;D>s;s++)_[h+3]=O=y*X>>V,0!==O?(O=255/O,_[h]=(v*X>>V)*O,_[h+1]=(m*X>>V)*O,_[h+2]=(g*X>>V)*O):_[h]=_[h+1]=_[h+2]=0,v-=b,m-=w,g-=E,y-=S,b-=z.r,w-=z.g,E-=z.b,S-=z.a,f=p+((f=s+i+1)<B?f:B)<<2,x+=z.r=_[f],T+=z.g=_[f+1],N+=z.b=_[f+2],C+=z.a=_[f+3],v+=x,m+=T,g+=N,y+=C,z=z.next,b+=k=W.r,w+=L=W.g,E+=A=W.b,S+=O=W.a,x-=k,T-=L,N-=A,C-=O,W=W.next,h+=4;p+=D}for(s=0;D>s;s++){for(T=N=C=x=m=g=y=v=0,h=s<<2,b=F*(k=_[h]),w=F*(L=_[h+1]),E=F*(A=_[h+2]),S=F*(O=_[h+3]),v+=I*k,m+=I*L,g+=I*A,y+=I*O,U=q,u=0;F>u;u++)U.r=k,U.g=L,U.b=A,U.a=O,U=U.next;for(l=D,u=1;i>=u;u++)h=l+s<<2,v+=(U.r=k=_[h])*(M=F-u),m+=(U.g=L=_[h+1])*M,g+=(U.b=A=_[h+2])*M,y+=(U.a=O=_[h+3])*M,x+=k,T+=L,N+=A,C+=O,U=U.next,j>u&&(l+=D);for(h=s,z=q,W=R,o=0;P>o;o++)f=h<<2,_[f+3]=O=y*X>>V,O>0?(O=255/O,_[f]=(v*X>>V)*O,_[f+1]=(m*X>>V)*O,_[f+2]=(g*X>>V)*O):_[f]=_[f+1]=_[f+2]=0,v-=b,m-=w,g-=E,y-=S,b-=z.r,w-=z.g,E-=z.b,S-=z.a,f=s+((f=o+F)<j?f:j)*D<<2,v+=x+=z.r=_[f],m+=T+=z.g=_[f+1],g+=N+=z.b=_[f+2],y+=C+=z.a=_[f+3],z=z.next,b+=k=W.r,w+=L=W.g,E+=A=W.b,S+=O=W.a,x-=k,T-=L,N-=A,C-=O,W=W.next,h+=D}}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(e){var n=0|this.blurRadius();n>0&&t(e,n)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e,t,n){var r=4*(n*e.width+t),i=[];return i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]),i}function t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function n(e){for(var t=[0,0,0],n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}function r(r,i){var s=e(r,0,0),o=e(r,r.width-1,0),u=e(r,0,r.height-1),f=e(r,r.width-1,r.height-1),l=i||10;if(t(s,o)<l&&t(o,f)<l&&t(f,u)<l&&t(u,s)<l){for(var h=n([o,s,f,u]),p=[],d=0;d<r.width*r.height;d++){var v=t(h,[r.data[4*d],r.data[4*d+1],r.data[4*d+2]]);p[d]=l>v?0:255}return p}}function i(e,t){for(var n=0;n<e.width*e.height;n++)e.data[4*n+3]=t[n]}function s(e,t,n){for(var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=2040===l?255:0}return o}function o(e,t,n){for(var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l>=1020?255:0}return o}function u(e,t,n){for(var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l}return o}Kinetic.Filters.Mask=function(e){var t=this.threshold(),n=r(e,t);return n&&(n=s(n,e.width,e.height),n=o(n,e.width,e.height),n=u(n,e.width,e.height),i(e,n)),e},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.RGB=function(e){var t,n,r=e.data,i=r.length,s=this.red(),o=this.green(),u=this.blue();for(t=0;i>t;t+=4)n=(.34*r[t]+.5*r[t+1]+.16*r[t+2])/255,r[t]=n*s,r[t+1]=n*o,r[t+2]=n*u,r[t+3]=r[t+3]},Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(e){return this._filterUpToDate=!1,e>255?255:0>e?0:Math.round(e)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(e){return this._filterUpToDate=!1,e>255?255:0>e?0:Math.round(e)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.HSV=function(e){var t,n,r,i,s,o=e.data,u=o.length,a=this.value(),f=this.saturation(),l=Math.abs(this.hue()+360)%360,c=a*f*Math.cos(l*Math.PI/180),h=a*f*Math.sin(l*Math.PI/180),p=.299*a+.701*c+.167*h,d=.587*a-.587*c+.33*h,v=.114*a-.114*c-.497*h,m=.299*a-.299*c-.328*h,g=.587*a+.413*c+.035*h,y=.114*a-.114*c+.293*h,b=.299*a-.3*c+1.25*h,w=.587*a-.586*c-1.05*h,E=.114*a+.886*c-.2*h;for(t=0;u>t;t+=4)n=o[t+0],r=o[t+1],i=o[t+2],s=o[t+3],o[t+0]=p*n+d*r+v*i,o[t+1]=m*n+g*r+y*i,o[t+2]=b*n+w*r+E*i,o[t+3]=s},Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",1,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",1,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Emboss=function(e){var t=10*this.embossStrength(),n=255*this.embossWhiteLevel(),r=this.embossDirection(),i=this.embossBlend(),s=0,o=0,u=e.data,a=e.width,f=e.height,l=4*a,c=f;switch(r){case"top-left":s=-1,o=-1;break;case"top":s=-1,o=0;break;case"top-right":s=-1,o=1;break;case"right":s=0,o=1;break;case"bottom-right":s=1,o=1;break;case"bottom":s=1,o=0;break;case"bottom-left":s=1,o=-1;break;case"left":s=0,o=-1}do{var h=(c-1)*l,p=s;1>c+p&&(p=0),c+p>f&&(p=0);var d=4*(c-1+p)*a,v=a;do{var m=h+4*(v-1),g=o;1>v+g&&(g=0),v+g>a&&(g=0);var y=d+4*(v-1+g),b=u[m]-u[y],w=u[m+1]-u[y+1],E=u[m+2]-u[y+2],S=b,x=S>0?S:-S,T=w>0?w:-w,N=E>0?E:-E;if(T>x&&(S=w),N>x&&(S=E),S*=t,i){var C=u[m]+S,k=u[m+1]+S,L=u[m+2]+S;u[m]=C>255?255:0>C?0:C,u[m+1]=k>255?255:0>k?0:k,u[m+2]=L>255?255:0>L?0:L}else{var A=n-S;0>A?A=0:A>255&&(A=255),u[m]=u[m+1]=u[m+2]=A}}while(--v)}while(--c)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e,t,n,r,i){var s,o=n-t,u=i-r;return 0===o?r+u/2:0===u?r:(s=(e-t)/o,s=u*s+r)}Kinetic.Filters.Enhance=function(t){var n,r,i,s,o=t.data,u=o.length,f=o[0],l=f,c=o[1],h=c,p=o[2],d=p,v=o[3],m=v,g=this.enhance();if(0!==g){for(s=0;u>s;s+=4)n=o[s+0],f>n?f=n:n>l&&(l=n),r=o[s+1],c>r?c=r:r>h&&(h=r),i=o[s+2],p>i?p=i:i>d&&(d=i);l===f&&(l=255,f=0),h===c&&(h=255,c=0),d===p&&(d=255,p=0),m===v&&(m=255,v=0);var y,b,w,E,S,x,T,N,C,k,L,A;for(g>0?(b=l+g*(255-l),w=f-g*(f-0),S=h+g*(255-h),x=c-g*(c-0),N=d+g*(255-d),A=p-g*(p-0),L=m+g*(255-m),C=v-g*(v-0)):(y=.5*(l+f),b=l+g*(l-y),w=f+g*(f-y),E=.5*(h+c),S=h+g*(h-E),x=c+g*(c-E),T=.5*(d+p),N=d+g*(d-T),A=p+g*(p-T),k=.5*(m+v),L=m+g*(m-k),C=v+g*(v-k)),s=0;u>s;s+=4)o[s+0]=e(o[s+0],f,l,w,b),o[s+1]=e(o[s+1],c,h,x,S),o[s+2]=e(o[s+2],p,d,A,N)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Posterize=function(e){var t,n=Math.round(254*this.levels())+1,r=e.data,i=r.length,s=255/n;for(t=0;i>t;t+=1)r[t]=Math.floor(r[t]/s)*s},Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Noise=function(e){var t,n=255*this.noise(),r=e.data,i=r.length,s=n/2;for(t=0;i>t;t+=4)r[t+0]+=s-2*s*Math.random(),r[t+1]+=s-2*s*Math.random(),r[t+2]+=s-2*s*Math.random()},Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Pixelate=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=Math.ceil(this.pixelSize()),m=e.width,g=e.height,e=e.data,y=Math.ceil(m/v),b=Math.ceil(g/v);for(h=0;y>h;h+=1)for(p=0;b>p;p+=1){for(i=0,s=0,o=0,u=0,a=h*v,f=a+v,l=p*v,c=l+v,d=0,t=a;f>t;t+=1)if(!(t>=m))for(n=l;c>n;n+=1)n>=g||(r=4*(m*n+t),i+=e[r+0],s+=e[r+1],o+=e[r+2],u+=e[r+3],d+=1);for(i/=d,s/=d,o/=d,alphas=u/d,t=a;f>t;t+=1)if(!(t>=m))for(n=l;c>n;n+=1)n>=g||(r=4*(m*n+t),e[r+0]=i,e[r+1]=s,e[r+2]=o,e[r+3]=u)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Threshold=function(e){var t,n=255*this.threshold(),r=e.data,i=r.length;for(t=0;i>t;t+=1)r[t]=r[t]<n?0:255},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Sepia=function(e){var t,n,r,i,s,o,u,a,f,l=e.data,c=e.width,h=e.height,p=4*c;do{t=(h-1)*p,n=c;do r=t+4*(n-1),i=l[r],s=l[r+1],o=l[r+2],u=.393*i+.769*s+.189*o,a=.349*i+.686*s+.168*o,f=.272*i+.534*s+.131*o,l[r]=u>255?255:u,l[r+1]=a>255?255:a,l[r+2]=f>255?255:f,l[r+3]=l[r+3];while(--n)}while(--h)}}(),function(){Kinetic.Filters.Solarize=function(e){var t=e.data,n=e.width,r=e.height,i=4*n,s=r;do{var o=(s-1)*i,u=n;do{var a=o+4*(u-1),f=t[a],l=t[a+1],c=t[a+2];f>127&&(f=255-f),l>127&&(l=255-l),c>127&&(c=255-c),t[a]=f,t[a+1]=l,t[a+2]=c}while(--u)}while(--s)}}(),function(){var e=function(e,t,n){var r,i,s,o,u=e.data,a=t.data,f=e.width,l=e.height,c=n.polarCenterX||f/2,h=n.polarCenterY||l/2,p=0,d=0,v=0,m=0,g=Math.sqrt(c*c+h*h);i=f-c,s=l-h,o=Math.sqrt(i*i+s*s),g=o>g?o:g;var y,b,w,E,S,x,T,N,C,k,L,A,O,M=l,_=f,D=360/_*Math.PI/180;for(b=0;_>b;b+=1)for(w=Math.sin(b*D),E=Math.cos(b*D),y=0;M>y;y+=1)i=c+g*y/M*E,s=h+g*y/M*w,1>=i&&(i=1),i>=f-.5&&(i=f-1),1>=s&&(s=1),s>=l-.5&&(s=l-1),S=i-.5,x=i+.5,T=Math.floor(S),N=Math.floor(x),C=s-.5,k=s+.5,L=Math.floor(C),A=Math.floor(k),O=(1-(S-T))*(1-(C-L)),r=4*(L*f+T),p=u[r+0]*O,d=u[r+1]*O,v=u[r+2]*O,m=u[r+3]*O,O=(1-(S-T))*(k-A),r=4*(A*f+T),p+=u[r+0]*O,d+=u[r+1]*O,v+=u[r+2]*O,m+=u[r+3]*O,O=(x-N)*(k-A),r=4*(A*f+N),p+=u[r+0]*O,d+=u[r+1]*O,v+=u[r+2]*O,m+=u[r+3]*O,O=(x-N)*(1-(C-L)),r=4*(L*f+N),p+=u[r+0]*O,d+=u[r+1]*O,v+=u[r+2]*O,m+=u[r+3]*O,r=4*(b+y*f),a[r+0]=p,a[r+1]=d,a[r+2]=v,a[r+3]=m},t=function(e,t,n){var r,i,s,o,u,a,f=e.data,l=t.data,c=e.width,h=e.height,p=n.polarCenterX||c/2,d=n.polarCenterY||h/2,v=0,m=0,g=0,y=0,b=Math.sqrt(p*p+d*d);i=c-p,s=h-d,a=Math.sqrt(i*i+s*s),b=a>b?a:b;var w,E,S=h,x=c,T=n.polarRotation||0;180*(x/360)/Math.PI;var N,C,k,L,A,O,M,_,D;for(i=0;c>i;i+=1)for(s=0;h>s;s+=1)o=i-p,u=s-d,w=Math.sqrt(o*o+u*u)*S/b,E=(180*Math.atan2(u,o)/Math.PI+360+T)%360,E=E*x/360,N=E-.5,C=E+.5,k=Math.floor(N),L=Math.floor(C),A=w-.5,O=w+.5,M=Math.floor(A),_=Math.floor(O),D=(1-(N-k))*(1-(A-M)),r=4*(M*c+k),v=f[r+0]*D,m=f[r+1]*D,g=f[r+2]*D,y=f[r+3]*D,D=(1-(N-k))*(O-_),r=4*(_*c+k),v+=f[r+0]*D,m+=f[r+1]*D,g+=f[r+2]*D,y+=f[r+3]*D,D=(C-L)*(O-_),r=4*(_*c+L),v+=f[r+0]*D,m+=f[r+1]*D,g+=f[r+2]*D,y+=f[r+3]*D,D=(C-L)*(1-(A-M)),r=4*(M*c+L),v+=f[r+0]*D,m+=f[r+1]*D,g+=f[r+2]*D,y+=f[r+3]*D,r=4*(s*c+i),l[r+0]=v,l[r+1]=m,l[r+2]=g,l[r+3]=y},n=document.createElement("canvas");Kinetic.Filters.Kaleidoscope=function(r){var i=r.width,s=r.height,o=Math.round(this.kaleidoscopePower()),u=Math.round(this.kaleidoscopeAngle()),f=Math.floor(i*(u%360)/360);if(!(1>o)){n.width=i,n.height=s;var l=n.getContext("2d").getImageData(0,0,i,s);e(r,l,{polarCenterX:i/2,polarCenterY:s/2});for(var h=i/Math.pow(2,o);8>=h;)h=2*h,o-=1;h=Math.ceil(h);var p=h,d=0,v=p,m=1;for(f+h>i&&(d=p,v=0,m=-1),y=0;s>y;y+=1)for(g=d;g!==v;g+=m)w=Math.round(g+f)%i,C=4*(i*y+w),S=l.data[C+0],x=l.data[C+1],T=l.data[C+2],N=l.data[C+3],k=4*(i*y+g),l.data[k+0]=S,l.data[k+1]=x,l.data[k+2]=T,l.data[k+3]=N;var g,y,w,E,S,x,T,N,C,k;for(y=0;s>y;y+=1)for(p=Math.floor(h),E=0;o>E;E+=1){for(g=0;p+1>g;g+=1)C=4*(i*y+g),S=l.data[C+0],x=l.data[C+1],T=l.data[C+2],N=l.data[C+3],k=4*(i*y+2*p-g-1),l.data[k+0]=S,l.data[k+1]=x,l.data[k+2]=T,l.data[k+3]=N;p*=2}t(l,r,{polarRotation:0})}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e){window.setTimeout(e,1e3/60)}var t=500;Kinetic.Animation=function(e,t){this.func=e,this.setLayers(t),this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={setLayers:function(e){var t=[];t=e?e.length>0?e:[e]:[],this.layers=t},getLayers:function(){return this.layers},addLayer:function(e){var t,n,r=this.layers;if(r){for(t=r.length,n=0;t>n;n++)if(r[n]._id===e._id)return!1}else this.layers=[];return this.layers.push(e),!0},isRunning:function(){for(var e=Kinetic.Animation,t=e.animations,n=0;n<t.length;n++)if(t[n].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(e){for(var t=e.id,n=this.animations,r=n.length,i=0;r>i;i++)if(n[i].id===t){this.animations.splice(i,1);break}},Kinetic.Animation._runFrames=function(){var e,t,n,r,i,s,o,u,a={},f=this.animations;for(r=0;r<f.length;r++){for(e=f[r],t=e.layers,n=e.func,e._updateFrameObject((new Date).getTime()),s=t.length,i=0;s>i;i++)o=t[i],void 0!==o._id&&(a[o._id]=o);n&&n.call(e,e.frame)}for(u in a)a[u].draw()},Kinetic.Animation._animationLoop=function(){var e=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){e._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var e=this;this.animRunning||(this.animRunning=!0,e._animationLoop())};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||e}();Kinetic.Animation.requestAnimFrame=function(t){var r=Kinetic.isDragging?e:n;r(t)};var r=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(e){r.call(this,e)},Kinetic.Layer.prototype.batchDraw=function(){var e=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){e.lastBatchDrawTime&&(new Date).getTime()-e.lastBatchDrawTime>t&&e.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(e){e.batchDraw()})}}(),function(){var e={node:1,duration:1,easing:1,onFinish:1,yoyo:1},t=1,n=2,r=3,i=0;Kinetic.Tween=function(t){var n,r=this,o=t.node,u=o._id,l=t.duration||1,c=t.easing||Kinetic.Easings.Linear,h=!!t.yoyo;this.node=o,this._id=i++,this.anim=new Kinetic.Animation(function(){r.tween.onEnterFrame()},o.getLayer()||o.getLayers()),this.tween=new s(n,function(e){r._tweenFunc(e)},c,0,1,1e3*l,h),this._addListeners(),Kinetic.Tween.attrs[u]||(Kinetic.Tween.attrs[u]={}),Kinetic.Tween.attrs[u][this._id]||(Kinetic.Tween.attrs[u][this._id]={}),Kinetic.Tween.tweens[u]||(Kinetic.Tween.tweens[u]={});for(n in t)void 0===e[n]&&this._addAttr(n,t[n]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(e,t){var n,r,i,s,o,u=this.node,a=u._id;if(i=Kinetic.Tween.tweens[a][e],i&&delete Kinetic.Tween.attrs[a][i][e],n=u.getAttr(e),Kinetic.Util._isArray(t))for(r=[],o=t.length,s=0;o>s;s++)r.push(t[s]-n[s]);else r=t-n;Kinetic.Tween.attrs[a][this._id][e]={start:n,diff:r},Kinetic.Tween.tweens[a][e]=this._id},_tweenFunc:function(e){var t,n,r,i,s,o,u,a=this.node,f=Kinetic.Tween.attrs[a._id][this._id];for(t in f){if(n=f[t],r=n.start,i=n.diff,Kinetic.Util._isArray(r))for(s=[],u=r.length,o=0;u>o;o++)s.push(r[o]+i[o]*e);else s=r+i*e;a.setAttr(t,s)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){e.onFinish&&e.onFinish()},this.tween.onReset=function(){e.onReset&&e.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var e=this.node;return this.tween.reset(),(e.getLayer()||e.getLayers()).draw(),this},seek:function(e){var t=this.node;return this.tween.seek(1e3*e),(t.getLayer()||t.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var e=this.node;return this.tween.finish(),(e.getLayer()||e.getLayers()).draw(),this},destroy:function(){var e,t=this.node._id,n=this._id,r=Kinetic.Tween.tweens[t];this.pause();for(e in r)delete Kinetic.Tween.tweens[t][e];delete Kinetic.Tween.attrs[t][n]}};var s=function(e,t,n,r,i,s,o){this.prop=e,this.propFunc=t,this.begin=r,this._pos=r,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()};s.prototype={fire:function(e){var t=this[e];t&&t()},setTime:function(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>e?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e},getPosition:function(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=n,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=r,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;this.state===n?this.setTime(e):this.state===r&&this.setTime(this.duration-e)},pause:function(){this.state=t,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(e,t,n,r){var i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t},BackEaseOut:function(e,t,n,r){var i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BackEaseInOut:function(e,t,n,r){var i=1.70158;return(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},ElasticEaseIn:function(e,t,n,r,i,s){var o=0;return 0===e?t:1==(e/=r)?t+n:(s||(s=.3*r),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},ElasticEaseOut:function(e,t,n,r,i,s){var o=0;return 0===e?t:1==(e/=r)?t+n:(s||(s=.3*r),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},ElasticEaseInOut:function(e,t,n,r,i,s){var o=0;return 0===e?t:2==(e/=r/2)?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),1>e?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:.5*i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},BounceEaseOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:2/2.75>e?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},BounceEaseIn:function(e,t,n,r){return n-Kinetic.Easings.BounceEaseOut(r-e,0,n,r)+t},BounceEaseInOut:function(e,t,n,r){return r/2>e?.5*Kinetic.Easings.BounceEaseIn(2*e,0,n,r)+t:.5*Kinetic.Easings.BounceEaseOut(2*e-r,0,n,r)+.5*n+t},EaseIn:function(e,t,n,r){return n*(e/=r)*e+t},EaseOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},EaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},StrongEaseIn:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},StrongEaseOut:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},StrongEaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},Linear:function(e,t,n,r){return n*e/r+t}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(e){var t=Kinetic.DD,n=t.node;n&&(n._setDragPosition(e),t.isDragging||(t.isDragging=!0,n.fire("dragstart",e,!0)),n.fire("dragmove",e,!0))},_endDragBefore:function(e){var t,n,r=Kinetic.DD,i=r.node;i&&(t=i.nodeType,n=i.getLayer(),r.anim.stop(),r.isDragging&&(r.isDragging=!1,Kinetic.listenClickTap=!1,e&&(e.dragEndNode=i)),delete r.node,(n||i).draw())},_endDragAfter:function(e){e=e||{};var t=e.dragEndNode;e&&t&&t.fire("dragend",e,!0)}},Kinetic.Node.prototype.startDrag=function(){var e=Kinetic.DD,t=this.getStage(),n=this.getLayer(),r=t.getPointerPosition(),i=this.getAbsolutePosition();r&&(e.node&&e.node.stopDrag(),e.node=this,e.offset.x=r.x-i.x,e.offset.y=r.y-i.y,e.anim.setLayers(n||this.getLayers()),e.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(e){var t=Kinetic.DD,n=this.getStage().getPointerPosition(),r=this.getDragBoundFunc(),i={x:n.x-t.offset.x,y:n.y-t.offset.y};void 0!==r&&(i=r.call(this,i,e)),this.setAbsolutePosition(i)},Kinetic.Node.prototype.stopDrag=function(){var e=Kinetic.DD,t={};e._endDragBefore(t),e._endDragAfter(t)},Kinetic.Node.prototype.setDraggable=function(e){this._setAttr("draggable",e),this._dragChange()};var e=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var t=Kinetic.DD;t.node&&t.node._id===this._id&&this.stopDrag(),e.call(this)},Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.isDragging},Kinetic.Node.prototype._listenDrag=function(){var e=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)}):this.on("mousedown.kinetic touchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage(),t=Kinetic.DD;e&&t.node&&t.node._id===this._id&&t.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var t=document.documentElement;t.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),t.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),t.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),t.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(e){this.children=new Kinetic.Collection,Kinetic.Node.call(this,e)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var e,t=this.children;t.length>0;)e=t[0],e.hasChildren()&&e.removeChildren(),e.remove();return this},destroyChildren:function(){for(var e=this.children;e.length>0;)e[0].destroy();return this},add:function(e){var t=this.children;return this._validateAdd(e),e.index=t.length,e.parent=this,t.push(e),this._fire("add",{child:e}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(e){var t,n,r,i,s,o,u,a=[],f=e.replace(/ /g,"").split(","),l=f.length;for(t=0;l>t;t++)if(r=f[t],"#"===r.charAt(0))s=this._getNodeById(r.slice(1)),s&&a.push(s);else if("."===r.charAt(0))i=this._getNodesByName(r.slice(1)),a=a.concat(i);else for(o=this.getChildren(),u=o.length,n=0;u>n;n++)a=a.concat(o[n]._get(r));return Kinetic.Collection.toCollection(a)},_getNodeById:function(e){var t=Kinetic.ids[e];return void 0!==t&&this.isAncestorOf(t)?t:null},_getNodesByName:function(e){var t=Kinetic.names[e]||[];return this._getDescendants(t)},_get:function(e){for(var t=Kinetic.Node.prototype._get.call(this,e),n=this.getChildren(),r=n.length,i=0;r>i;i++)t=t.concat(n[i]._get(e));return t},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];for(var t=this.getChildren(),n=t.length,r=0;n>r;r++){var i=t[r];e.children.push(i.toObject())}return e},_getDescendants:function(e){for(var t=[],n=e.length,r=0;n>r;r++){var i=e[r];this.isAncestorOf(i)&&t.push(i)}return t},isAncestorOf:function(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(e){var t=Kinetic.Node.prototype.clone.call(this,e);return this.getChildren().each(function(e){t.add(e.clone())}),t},getAllIntersections:function(e){var t=[];return this.find("Shape").each(function(n){n.isVisible()&&n.intersects(e)&&t.push(n)}),t},_setChildrenIndices:function(){this.children.each(function(e,t){e.index=t})},drawScene:function(e){var t=this.getLayer(),n=e||t&&t.getCanvas(),r=n&&n.getContext(),i=this._cache.canvas,s=i&&i.scene;return this.isVisible()&&(s?this._drawCachedSceneCanvas(r):this._drawChildren(n,"drawScene")),this},drawHit:function(e){var t=this.getLayer(),n=e||t&&t.hitCanvas,r=n&&n.getContext(),i=this._cache.canvas,s=i&&i.hit;return this.shouldDrawHit()&&(s?this._drawCachedHitCanvas(r):this._drawChildren(n,"drawHit")),this},_drawChildren:function(e,t){var n,r,i=e&&e.getContext(),s=this.getClipWidth(),o=this.getClipHeight(),u=s&&o;u&&(n=this.getClipX(),r=this.getClipY(),i.save(),i._applyTransform(this),i.beginPath(),i.rect(n,r,s,o),i.clip(),i.reset()),this.children.each(function(n){n[t](e)}),u&&i.restore()}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight"),Kinetic.Collection.mapMethods(Kinetic.Container)}(),function(){function e(e){e.fill()}function t(e){e.stroke()}function n(e){e.fill()}function r(e){e.stroke()}function i(){this._clearCache(s)}var s="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(s){this.nodeType="Shape",this._fillFunc=e,this._strokeFunc=t,this._fillFuncHit=n,this._strokeFuncHit=r;for(var o,u=Kinetic.shapes;;)if(o=Kinetic.Util.getRandomColor(),o&&!(o in u))break;this.colorKey=o,u[o]=this,Kinetic.Node.call(this,s),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChanged.kinetic",i)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(s,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(e){return this.className===e||this.nodeType===e?[this]:[]},intersects:function(e){var t,n=this.getStage(),r=n.bufferHitCanvas;return r.getContext().clear(),this.drawScene(r),t=r.context.getImageData(0|e.x,0|e.y,1,1).data,t[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(e){var t,n,r,i=e||this.getLayer().getCanvas(),s=i.getContext(),o=this._cache.canvas,u=this.sceneFunc(),a=this.hasShadow();return this.isVisible()&&(o?this._drawCachedSceneCanvas(s):u&&(s.save(),this._useBufferCanvas()?(t=this.getStage(),n=t.bufferCanvas,r=n.getContext(),r.clear(),r.save(),r._applyLineJoin(this),r._applyTransform(this),u.call(this,r),r.restore(),a&&(s.save(),s._applyShadow(this),s.drawImage(n._canvas,0,0),s.restore()),s._applyOpacity(this),s.drawImage(n._canvas,0,0)):(s._applyLineJoin(this),s._applyTransform(this),a&&(s.save(),s._applyShadow(this),u.call(this,s),s.restore()),s._applyOpacity(this),u.call(this,s)),s.restore())),this},drawHit:function(e){var t=e||this.getLayer().hitCanvas,n=t.getContext(),r=this.hitFunc()||this.sceneFunc(),i=this._cache.canvas,s=i&&i.hit;return this.shouldDrawHit()&&(s?this._drawCachedHitCanvas(n):r&&(n.save(),n._applyLineJoin(this),n._applyTransform(this),r.call(this,n),n.restore())),this},drawHitFromCache:function(e){var t,n,r,i,s,o,u,a,f=e||0,l=this._cache.canvas,c=this._getCachedSceneCanvas(),h=c.getContext(),p=l.hit,d=p.getContext(),v=c.getWidth(),m=c.getHeight();d.clear();try{for(t=h.getImageData(0,0,v,m),n=t.data,r=d.getImageData(0,0,v,m),i=r.data,s=n.length,o=Kinetic.Util._hexToRgb(this.colorKey),u=0;s>u;u+=4)a=n[u+3],a>f&&(i[u]=o.r,i[u+1]=o.g,i[u+2]=o.b,i[u+3]=255);d.putImageData(r,0,0)}catch(g){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+g.message)}return this}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0),Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),Kinetic.Collection.mapMethods(Kinetic.Shape)}(),function(){function e(e,t){e.content.addEventListener(t,function(n){e[P+t](n)},!1)}var t="Stage",n="string",r="px",i="mouseout",s="mouseleave",o="mouseover",u="mouseenter",a="mousemove",f="mousedown",l="mouseup",c="click",h="dblclick",p="touchstart",d="touchend",v="tap",m="dbltap",g="touchmove",y="contentMouseout",b="contentMouseover",w="contentMousemove",E="contentMousedown",S="contentMouseup",x="contentClick",T="contentDblclick",N="contentTouchstart",C="contentTouchend",k="contentDbltap",L="contentTouchmove",A="div",O="relative",M="inline-block",_="kineticjs-content",D=" ",P="_",H="container",B="",j=[f,a,l,i,p,g,d,o],F=j.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(e){this.nodeType=t,Kinetic.Container.call(this,e),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)},_validateAdd:function(e){"Layer"!==e.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(e){return typeof e===n&&(e=document.getElementById(e)),this._setAttr(H,e),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(e){return Kinetic.Node.prototype.setHeight.call(this,e),this._resizeDOM(),this},setWidth:function(e){return Kinetic.Node.prototype.setWidth.call(this,e),this._resizeDOM(),this},clear:function(){var e,t=this.children,n=t.length;for(e=0;n>e;e++)t[e].clear();return this},destroy:function(){var e=this.content;Kinetic.Container.prototype.destroy.call(this),e&&Kinetic.Util._isInDocument(e)&&this.getContainer().removeChild(e)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function t(i){var s=a[i],f=s.toDataURL(),l=new Image;l.onload=function(){u.drawImage(l,0,0),i<a.length-1?t(i+1):e.callback(o.toDataURL(n,r))},l.src=f}e=e||{};var n=e.mimeType||null,r=e.quality||null,i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:1}),u=o.getContext()._context,a=this.children;(i||s)&&u.translate(-1*i,-1*s),t(0)},toImage:function(e){var t=e.callback;e.callback=function(e){Kinetic.Util._getImage(e,function(e){t(e)})},this.toDataURL(e)},getIntersection:function(e){var t,n,r=this.getChildren(),i=r.length,s=i-1;for(t=s;t>=0;t--)if(n=r[t].getIntersection(e))return n;return null},_resizeDOM:function(){if(this.content){var e,t,n=this.getWidth(),i=this.getHeight(),s=this.getChildren(),o=s.length;for(this.content.style.width=n+r,this.content.style.height=i+r,this.bufferCanvas.setSize(n,i),this.bufferHitCanvas.setSize(n,i),e=0;o>e;e++)t=s[e],t.getCanvas().setSize(n,i),t.hitCanvas.setSize(n,i),t.draw()}},add:function(e){return Kinetic.Container.prototype.add.call(this,e),e.canvas.setSize(this.attrs.width,this.attrs.height),e.hitCanvas.setSize(this.attrs.width,this.attrs.height),e.draw(),this.content.appendChild(e.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){var t;for(t=0;F>t;t++)e(this,j[t])},_mouseover:function(e){this._fire(b,e)},_mouseout:function(e){this._setPointerPosition(e);var t=this.targetShape;t&&!Kinetic.isDragging()&&(t._fireAndBubble(i,e),t._fireAndBubble(s,e),this.targetShape=null),this.pointerPos=void 0,this._fire(y,e)},_mousemove:function(e){this._setPointerPosition(e);var t=Kinetic.DD,n=this.getIntersection(this.getPointerPosition());n&&n.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===n._id?n._fireAndBubble(a,e):(this.targetShape&&(this.targetShape._fireAndBubble(i,e,n),this.targetShape._fireAndBubble(s,e,n)),n._fireAndBubble(o,e,this.targetShape),n._fireAndBubble(u,e,this.targetShape),this.targetShape=n):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(i,e),this.targetShape._fireAndBubble(s,e),this.targetShape=null),this._fire(w,e),t&&t._drag(e),e.preventDefault&&e.preventDefault()},_mousedown:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,t&&t.isListening()&&(this.clickStartShape=t,t._fireAndBubble(f,e)),this._fire(E,e),e.preventDefault&&e.preventDefault()},_mouseup:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=this.clickStartShape,r=!1;Kinetic.inDblClickWindow?(r=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(l,e),Kinetic.listenClickTap&&n&&n._id===t._id&&(t._fireAndBubble(c,e),r&&t._fireAndBubble(h,e))),this._fire(S,e),Kinetic.listenClickTap&&(this._fire(x,e),r&&this._fire(T,e)),Kinetic.listenClickTap=!1,e.preventDefault&&e.preventDefault()},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,t&&t.isListening()&&(this.tapStartShape=t,t._fireAndBubble(p,e),t.isListening()&&e.preventDefault&&e.preventDefault()),this._fire(N,e)},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());fireDblClick=!1,Kinetic.inDblClickWindow?(fireDblClick=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(d,e),Kinetic.listenClickTap&&t._id===this.tapStartShape._id&&(t._fireAndBubble(v,e),fireDblClick&&t._fireAndBubble(m,e)),t.isListening()&&e.preventDefault&&e.preventDefault()),Kinetic.listenClickTap&&(this._fire(C,e),fireDblClick&&this._fire(k,e)),Kinetic.listenClickTap=!1},_touchmove:function(e){this._setPointerPosition(e);var t=Kinetic.DD,n=this.getIntersection(this.getPointerPosition());n&&n.isListening()&&(n._fireAndBubble(g,e),n.isListening()&&e.preventDefault&&e.preventDefault()),this._fire(L,e),t&&t._drag(e)},_setPointerPosition:function(e){var t,e=e?e:window.event,n=this._getContentPosition(),r=e.offsetX,i=e.clientX,s=null,o=null;void 0!==e.touches?1===e.touches.length&&(t=e.touches[0],s=t.clientX-n.left,o=t.clientY-n.top):void 0!==r?(s=r,o=e.offsetY):"mozilla"===Kinetic.UA.browser?(s=e.layerX,o=e.layerY):void 0!==i&&n&&(s=i-n.left,o=e.clientY-n.top),null!==s&&null!==o&&(this.pointerPos={x:s,y:o})},_getContentPosition:function(){var e=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:e.top,left:e.left}},_buildDOM:function(){var e=this.getContainer();e.innerHTML=B,this.content=document.createElement(A),this.content.style.position=O,this.content.style.display=M,this.content.className=_,this.content.setAttribute("role","presentation"),e.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(e,t){var n,r,i=e.split(D),s=i.length;for(n=0;s>n;n++)r=i[n],this.content.addEventListener(r,t,!1)}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}(),function(){var e="#",t="beforeDraw",n="draw",r=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],i=r.length;Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(e){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(e){var t,n,s,o;if(!this.isVisible())return null;for(n=0;i>n;n++){if(s=r[n],t=this._getIntersection({x:e.x+s.x,y:e.y+s.y}),o=t.shape)return o;if(!t.antialiased)return null}},_getIntersection:function(t){var n,r,i=this.hitCanvas.context._context.getImageData(t.x,t.y,1,1).data,s=i[3];return 255===s?(n=Kinetic.Util._rgbToHex(i[0],i[1],i[2]),r=Kinetic.shapes[e+n],{shape:r}):s>0?{antialiased:!0}:{}},drawScene:function(e){var r=this.getLayer(),i=e||r&&r.getCanvas();return this._fire(t,{node:this}),this.getClearBeforeDraw()&&i.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,i),this._fire(n,{node:this}),this},drawHit:function(e){var t=this.getLayer(),n=e||t&&t.hitCanvas;return t&&t.getClearBeforeDraw()&&t.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,n),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(e){var t=this.getContext(),n=this.getHitCanvas().getContext();return t.clear(e),n.clear(e),this},setVisible:function(e){return Kinetic.Node.prototype.setVisible.call(this,e),e?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),e<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[e+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),e.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),this.index<e.getChildren().length-1?e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var e=this.getStage(),t=this.getCanvas(),n=t._canvas;return Kinetic.Node.prototype.remove.call(this),e&&n&&Kinetic.Util._isInDocument(n)&&e.content.removeChild(n),this},getStage:function(){return this.parent},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0),Kinetic.Collection.mapMethods(Kinetic.Layer)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(e){this.nodeType="Group",Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)}(),function(){Kinetic.Rect=function(e){this.___init(e)},Kinetic.Rect.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getCornerRadius(),n=this.getWidth(),r=this.getHeight();e.beginPath(),t?(e.moveTo(t,0),e.lineTo(n-t,0),e.arc(n-t,t,t,3*Math.PI/2,0,!1),e.lineTo(n,r-t),e.arc(n-t,r-t,t,0,Math.PI/2,!1),e.lineTo(t,r),e.arc(t,r-t,t,Math.PI/2,Math.PI,!1),e.lineTo(0,t),e.arc(t,t,t,Math.PI,3*Math.PI/2,!1)):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Rect)}(),function(){var e=2*Math.PI-1e-4,t="Circle";Kinetic.Circle=function(e){this.___init(e)},Kinetic.Circle.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath(),t.arc(0,0,this.getRadius(),0,e,!1),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius(e/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0),Kinetic.Collection.mapMethods(Kinetic.Circle)}(),function(){var e=2*Math.PI-1e-4,t="Ellipse";Kinetic.Ellipse=function(e){this.___init(e)},Kinetic.Ellipse.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){var n=this.getRadius(),r=n.x,i=n.y;t.beginPath(),t.save(),r!==i&&t.scale(1,i/r),t.arc(0,0,r,0,e,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius({y:e/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)}(),function(){var e=2*Math.PI-1e-4;Kinetic.Ring=function(e){this.___init(e)},Kinetic.Ring.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath(),t.arc(0,0,this.getInnerRadius(),0,e,!1),t.moveTo(this.getOuterRadius(),0),t.arc(0,0,this.getOuterRadius(),e,0,!0),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setOuterRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setOuterRadius(e/2)}},Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Ring)}(),function(){Kinetic.Wedge=function(e){this.___init(e)},Kinetic.Wedge.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.beginPath(),e.arc(0,0,this.getRadius(),0,this.getAngle()*Math.PI/180,this.getClockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1),Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Kinetic.Collection.mapMethods(Kinetic.Wedge)}(),function(){Kinetic.Arc=function(e){this.___init(e)},Kinetic.Arc.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.angle()*Math.PI/180,n=this.clockwise();e.beginPath(),e.arc(0,0,this.getOuterRadius(),0,t,n),e.arc(0,0,this.getInnerRadius(),t,0,!n),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1),Kinetic.Collection.mapMethods(Kinetic.Arc)}(),function(){var e="Image";Kinetic.Image=function(e){this.___init(e)},Kinetic.Image.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(e){var t,n,r,i,s=this.getWidth(),o=this.getHeight(),u=this.getImage();u&&(t=this.getCrop(),n=t.width,r=t.height,i=n&&r?[u,t.x,t.y,n,r,0,0,s,o]:[u,0,0,s,o]),e.beginPath(),e.rect(0,0,s,o),e.closePath(),e.fillStrokeShape(this),u&&e.drawImage.apply(e,i)},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){var e=this.getImage();return this.attrs.width||(e?e.width:0)},getHeight:function(){var e=this.getImage();return this.attrs.height||(e?e.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0),Kinetic.Collection.mapMethods(Kinetic.Image)}(),function(){function e(e){e.fillText(this.partialText,0,0)}function t(e){e.strokeText(this.partialText,0,0)}var n="auto",r="canvas",i="center",s="Change.kinetic",o="2d",u="-",a="",f="left",l="text",c="Text",h="middle",p="normal",d="px ",v=" ",m="right",g="word",y="char",b="none",w=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],E=w.length,S=document.createElement(r).getContext(o);Kinetic.Text=function(e){this.___init(e)},Kinetic.Text.prototype={___init:function(r){var i=this;void 0===r.width&&(r.width=n),void 0===r.height&&(r.height=n),Kinetic.Shape.call(this,r),this._fillFunc=e,this._strokeFunc=t,this.className=c;for(var o=0;E>o;o++)this.on(w[o]+s,i._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var t,n=this.getPadding(),r=this.getTextHeight(),s=this.getLineHeight()*r,o=this.textArr,u=o.length,a=this.getWidth();for(e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",h),e.setAttr("textAlign",f),e.save(),e.translate(n,0),e.translate(0,n+r/2),t=0;u>t;t++){var l=o[t],c=l.text,p=l.width;e.save(),this.getAlign()===m?e.translate(a-p-2*n,0):this.getAlign()===i&&e.translate((a-p-2*n)/2,0),this.partialText=c,e.fillStrokeShape(this),e.restore(),e.translate(0,s)}e.restore()},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},setText:function(e){var t=Kinetic.Util._isString(e)?e:e.toString();return this._setAttr(l,t),this},getWidth:function(){return this.attrs.width===n?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===n?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var t,n=S,r=this.getFontSize();return n.save(),n.font=this._getContextFont(),t=n.measureText(e),n.restore(),{width:t.width,height:parseInt(r,10)}},_getContextFont:function(){return this.getFontStyle()+v+this.getFontSize()+d+this.getFontFamily()},_addTextLine:function(e,t){return this.textArr.push({text:e,width:t})},_getTextWidth:function(e){return S.measureText(e).width},_setTextData:function(){var e=this.getText().split("\n"),t=+this.getFontSize(),r=0,i=this.getLineHeight()*t,s=this.attrs.width,o=this.attrs.height,a=s!==n,f=o!==n,l=this.getPadding(),c=s-2*l,h=o-2*l,p=0,m=this.getWrap(),g=m!==b,w=m!==y&&g;this.textArr=[],S.save(),S.font=this.getFontStyle()+v+t+d+this.getFontFamily();for(var E=0,x=e.length;x>E;++E){var T=e[E],N=this._getTextWidth(T);if(a&&N>c)for(;T.length>0;){for(var C=0,k=T.length,L="",A=0;k>C;){var O=C+k>>>1,M=T.slice(0,O+1),_=this._getTextWidth(M);c>=_?(C=O+1,L=M,A=_):k=O}if(!L)break;if(w){var D=Math.max(L.lastIndexOf(v),L.lastIndexOf(u))+1;D>0&&(C=D,L=L.slice(0,C),A=this._getTextWidth(L))}if(this._addTextLine(L,A),p+=i,!g||f&&p+i>h)break;if(T=T.slice(C),T.length>0&&(N=this._getTextWidth(T),c>=N)){this._addTextLine(T,N),p+=i;break}}else this._addTextLine(T,N),p+=i,r=Math.max(r,N);if(f&&p+i>h)break}S.restore(),this.textHeight=t,this.textWidth=r}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",p),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",f),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",g),Kinetic.Factory.addGetter(Kinetic.Text,"text",a),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text"),Kinetic.Collection.mapMethods(Kinetic.Text)}(),function(){Kinetic.Line=function(e){this.___init(e)},Kinetic.Line.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t,n,r,i=this.getPoints(),s=i.length,o=this.getTension(),u=this.getClosed();if(e.beginPath(),e.moveTo(i[0],i[1]),0!==o&&s>4){for(t=this.getTensionPoints(),n=t.length,r=u?0:4,u||e.quadraticCurveTo(t[0],t[1],t[2],t[3]);n-2>r;)e.bezierCurveTo(t[r++],t[r++],t[r++],t[r++],t[r++],t[r++]);u||e.quadraticCurveTo(t[n-2],t[n-1],i[s-2],i[s-1])}else for(r=2;s>r;r+=2)e.lineTo(i[r],i[r+1]);u?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=Kinetic.Util,i=r._getControlPoints(e[t-2],e[t-1],e[0],e[1],e[2],e[3],n),s=r._getControlPoints(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],n),o=Kinetic.Util._expandPoints(e,n),u=[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]]);return u}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0),Kinetic.Factory.addGetterSetter(Kinetic.Line,"points"),Kinetic.Collection.mapMethods(Kinetic.Line)}(),function(){Kinetic.Sprite=function(e){this.___init(e)},Kinetic.Sprite.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Sprite",this.anim=new Kinetic.Animation,this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=4*n,i=this.getAnimations()[t],s=i[r+0],o=i[r+1],u=i[r+2],a=i[r+3],f=this.getImage();f&&e.drawImage(f,s,o,u,a,0,0,u,a)},_hitFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=4*n,i=this.getAnimations()[t],s=i[r+2],o=i[r+3];e.beginPath(),e.rect(0,0,s,o),e.closePath(),e.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var e=this,t=this.getLayer();this.anim.setLayers(t),this.interval=setInterval(function(){e._updateIndex()},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},_updateIndex:function(){var e=this.frameIndex(),t=this.getAnimation(),n=this.getAnimations(),r=n[t],i=r.length/4;i-1>e?this.frameIndex(e+1):this.frameIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17),Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Kinetic.Collection.mapMethods(Kinetic.Sprite)}(),function(){Kinetic.Path=function(e){this.___init(e)},Kinetic.Path.prototype={___init:function(e){this.dataArray=[];var t=this;Kinetic.Shape.call(this,e),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.dataArray,n=!1;e.beginPath();for(var r=0;r<t.length;r++){var i=t[r].command,s=t[r].points;switch(i){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=s[6],p=s[7],d=a>f?a:f,v=a>f?1:a/f,m=a>f?f/a:1;e.translate(o,u),e.rotate(h),e.scale(v,m),e.arc(0,0,d,l,l+c,1-p),e.scale(1/v,1/m),e.rotate(-h),e.translate(-o,-u);break;case"z":e.closePath(),n=!0}}n?e.fillStrokeShape(this):e.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))},Kinetic.Path.getPointOnLine=function(e,t,n,r,i,s,o){void 0===s&&(s=t),void 0===o&&(o=n);var u=(i-n)/(r-t+1e-8),a=Math.sqrt(e*e/(1+u*u));t>r&&(a*=-1);var f,l=u*a;if(r===t)f={x:s,y:o+l};else if((o-n)/(s-t+1e-8)===u)f={x:s+a,y:o+l};else{var c,h,p=this.getLineLength(t,n,r,i);if(1e-8>p)return void 0;var d=(s-t)*(r-t)+(o-n)*(i-n);d/=p*p,c=t+d*(r-t),h=n+d*(i-n);var v=this.getLineLength(s,o,c,h),m=Math.sqrt(e*e-v*v);a=Math.sqrt(m*m/(1+u*u)),t>r&&(a*=-1),l=u*a,f={x:c+a,y:h+l}}return f},Kinetic.Path.getPointOnCubicBezier=function(e,t,n,r,i,s,o,u,a){function f(e){return e*e*e}function l(e){return 3*e*e*(1-e)}function c(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}var p=u*f(e)+s*l(e)+r*c(e)+t*h(e),d=a*f(e)+o*l(e)+i*c(e)+n*h(e);return{x:p,y:d}},Kinetic.Path.getPointOnQuadraticBezier=function(e,t,n,r,i,s,o){function u(e){return e*e}function a(e){return 2*e*(1-e)}function f(e){return(1-e)*(1-e)}var l=s*u(e)+r*a(e)+t*f(e),c=o*u(e)+i*a(e)+n*f(e);return{x:l,y:c}},Kinetic.Path.getPointOnEllipticalArc=function(e,t,n,r,i,s){var o=Math.cos(s),u=Math.sin(s),a={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:e+(a.x*o-a.y*u),y:t+(a.x*u+a.y*o)}},Kinetic.Path.parsePathData=function(e){if(!e)return[];var t=e,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)t=t.replace(new RegExp(n[r],"g"),"|"+n[r]);var i=t.split("|"),s=[],o=0,u=0;for(r=1;r<i.length;r++){var a=i[r],f=a.charAt(0);a=a.slice(1),a=a.replace(new RegExp(",-","g"),"-"),a=a.replace(new RegExp("-","g"),",-"),a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");l.length>0&&""===l[0]&&l.shift();for(var c=0;c<l.length;c++)l[c]=parseFloat(l[c]);for(;l.length>0&&!isNaN(l[0]);){var h,p,d,v,m,g,y,b,w,E,S=null,x=[],T=o,N=u;switch(f){case"l":o+=l.shift(),u+=l.shift(),S="L",x.push(o,u);break;case"L":o=l.shift(),u=l.shift(),x.push(o,u);break;case"m":var C=l.shift(),k=l.shift();if(o+=C,u+=k,S="M",s.length>2&&"z"===s[s.length-1].command)for(var L=s.length-2;L>=0;L--)if("M"===s[L].command){o=s[L].points[0]+C,u=s[L].points[1]+k;break}x.push(o,u),f="l";break;case"M":o=l.shift(),u=l.shift(),S="M",x.push(o,u),f="L";break;case"h":o+=l.shift(),S="L",x.push(o,u);break;case"H":o=l.shift(),S="L",x.push(o,u);break;case"v":u+=l.shift(),S="L",x.push(o,u);break;case"V":u=l.shift(),S="L",x.push(o,u);break;case"C":x.push(l.shift(),l.shift(),l.shift(),l.shift()),o=l.shift(),u=l.shift(),x.push(o,u);break;case"c":x.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="C",x.push(o,u);break;case"S":p=o,d=u,h=s[s.length-1],"C"===h.command&&(p=o+(o-h.points[2]),d=u+(u-h.points[3])),x.push(p,d,l.shift(),l.shift()),o=l.shift(),u=l.shift(),S="C",x.push(o,u);break;case"s":p=o,d=u,h=s[s.length-1],"C"===h.command&&(p=o+(o-h.points[2]),d=u+(u-h.points[3])),x.push(p,d,o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="C",x.push(o,u);break;case"Q":x.push(l.shift(),l.shift()),o=l.shift(),u=l.shift(),x.push(o,u);break;case"q":x.push(o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="Q",x.push(o,u);break;case"T":p=o,d=u,h=s[s.length-1],"Q"===h.command&&(p=o+(o-h.points[0]),d=u+(u-h.points[1])),o=l.shift(),u=l.shift(),S="Q",x.push(p,d,o,u);break;case"t":p=o,d=u,h=s[s.length-1],"Q"===h.command&&(p=o+(o-h.points[0]),d=u+(u-h.points[1])),o+=l.shift(),u+=l.shift(),S="Q",x.push(p,d,o,u);break;case"A":v=l.shift(),m=l.shift(),g=l.shift(),y=l.shift(),b=l.shift(),w=o,E=u,o=l.shift(),u=l.shift(),S="A",x=this.convertEndpointToCenterParameterization(w,E,o,u,y,b,v,m,g);break;case"a":v=l.shift(),m=l.shift(),g=l.shift(),y=l.shift(),b=l.shift(),w=o,E=u,o+=l.shift(),u+=l.shift(),S="A",x=this.convertEndpointToCenterParameterization(w,E,o,u,y,b,v,m,g)}s.push({command:S||f,points:x,start:{x:T,y:N},pathLength:this.calcLength(T,N,S||f,x)})}("z"===f||"Z"===f)&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s},Kinetic.Path.calcLength=function(e,n,r,i){var s,o,u,a=Kinetic.Path;switch(r){case"L":return a.getLineLength(e,n,i[0],i[1]);case"C":for(s=0,o=a.getPointOnCubicBezier(0,e,n,i[0],i[1],i[2],i[3],i[4],i[5]),t=.01;1>=t;t+=.01)u=a.getPointOnCubicBezier(t,e,n,i[0],i[1],i[2],i[3],i[4],i[5]),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return s;case"Q":for(s=0,o=a.getPointOnQuadraticBezier(0,e,n,i[0],i[1],i[2],i[3]),t=.01;1>=t;t+=.01)u=a.getPointOnQuadraticBezier(t,e,n,i[0],i[1],i[2],i[3]),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return s;case"A":s=0;var f=i[4],l=i[5],c=i[4]+l,h=Math.PI/180;if(Math.abs(f-c)<h&&(h=Math.abs(f-c)),o=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),0>l)for(t=f-h;t>c;t-=h)u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;else for(t=f+h;c>t;t+=h)u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],c,0),s+=a.getLineLength(o.x,o.y,u.x,u.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180),l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2,c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2,h=l*l/(o*o)+c*c/(u*u);h>1&&(o*=Math.sqrt(h),u*=Math.sqrt(h));var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));i==s&&(p*=-1),isNaN(p)&&(p=0);var d=p*o*c/u,v=p*-u*l/o,m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v,g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},E=w([1,0],[(l-d)/o,(c-v)/u]),S=[(l-d)/o,(c-v)/u],x=[(-1*l-d)/o,(-1*c-v)/u],T=w(S,x);return b(S,x)<=-1&&(T=Math.PI),b(S,x)>=1&&(T=0),0===s&&T>0&&(T-=2*Math.PI),1==s&&0>T&&(T+=2*Math.PI),[m,g,o,u,E,T,f,s]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data"),Kinetic.Collection.mapMethods(Kinetic.Path)}(),function(){function e(e){e.fillText(this.partialText,0,0)}function t(e){e.strokeText(this.partialText,0,0)}var n="",r="normal";Kinetic.TextPath=function(e){this.___init(e)},Kinetic.TextPath.prototype={___init:function(n){var r=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,n),this._fillFunc=e,this._strokeFunc=t,this._fillFuncHit=e,this._strokeFuncHit=t,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){r.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",r._setTextData),r._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline","middle"),e.setAttr("textAlign","left"),e.save();for(var t=this.glyphInfo,n=0;n<t.length;n++){e.save();var r=t[n].p0;e.translate(r.x,r.y),e.rotate(t[n].rotation),this.partialText=t[n].text,e.fillStrokeShape(this),e.restore()}e.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var t=this.dummyCanvas,n=t.getContext("2d");n.save(),n.font=this._getContextFont();var r=n.measureText(e);return n.restore(),{width:r.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,t=this._getTextSize(this.attrs.text);this.textWidth=t.width,this.textHeight=t.height,this.glyphInfo=[];for(var n,r,i,s=this.attrs.text.split(""),o=-1,u=0,a=function(){u=0;for(var t=e.dataArray,r=o+1;r<t.length;r++){if(t[r].pathLength>0)return o=r,t[r];"M"==t[r].command&&(n={x:t[r].points[0],y:t[r].points[1]})}return{}},f=function(t){var s=e._getTextSize(t).width,o=0,f=0;for(r=void 0;Math.abs(s-o)/s>.01&&25>f;){f++;for(var l=o;void 0===i;)i=a(),i&&l+i.pathLength<s&&(l+=i.pathLength,i=void 0);if(i==={}||void 0===n)return void 0;var c=!1;switch(i.command){case"L":Kinetic.Path.getLineLength(n.x,n.y,i.points[0],i.points[1])>s?r=Kinetic.Path.getPointOnLine(s,n.x,n.y,i.points[0],i.points[1],n.x,n.y):i=void 0;break;case"A":var h=i.points[4],p=i.points[5],d=i.points[4]+p;0===u?u=h+1e-8:s>o?u+=Math.PI/180*p/Math.abs(p):u-=Math.PI/360*p/Math.abs(p),(0>p&&d>u||p>=0&&u>d)&&(u=d,c=!0),r=Kinetic.Path.getPointOnEllipticalArc(i.points[0],i.points[1],i.points[2],i.points[3],u,i.points[6]);break;case"C":0===u?u=s>i.pathLength?1e-8:s/i.pathLength:s>o?u+=(s-o)/i.pathLength:u-=(o-s)/i.pathLength,u>1&&(u=1,c=!0),r=Kinetic.Path.getPointOnCubicBezier(u,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3],i.points[4],i.points[5]);break;case"Q":0===u?u=s/i.pathLength:s>o?u+=(s-o)/i.pathLength:u-=(o-s)/i.pathLength,u>1&&(u=1,c=!0),r=Kinetic.Path.getPointOnQuadraticBezier(u,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3])}void 0!==r&&(o=Kinetic.Path.getLineLength(n.x,n.y,r.x,r.y)),c&&(c=!1,i=void 0)}},l=0;l<s.length&&(f(s[l]),void 0!==n&&void 0!==r);l++){var c=Kinetic.Path.getLineLength(n.x,n.y,r.x,r.y),h=0,p=Kinetic.Path.getPointOnLine(h+c/2,n.x,n.y,r.x,r.y),d=Math.atan2(r.y-n.y,r.x-n.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:s[l],rotation:d,p0:n,p1:r}),n=r}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",r),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",n),Kinetic.Collection.mapMethods(Kinetic.TextPath)}(),function(){Kinetic.RegularPolygon=function(e){this.___init(e)},Kinetic.RegularPolygon.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t,n,r,i=this.attrs.sides,s=this.attrs.radius;for(e.beginPath(),e.moveTo(0,0-s),t=1;i>t;t++)n=s*Math.sin(2*t*Math.PI/i),r=-1*s*Math.cos(2*t*Math.PI/i),e.lineTo(n,r);e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}(),function(){Kinetic.Star=function(e){this.___init(e)},Kinetic.Star.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();e.beginPath(),e.moveTo(0,0-n);for(var i=1;2*r>i;i++){var s=0===i%2?n:t,o=s*Math.sin(i*Math.PI/r),u=-1*s*Math.cos(i*Math.PI/r);e.lineTo(o,u)}e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Star)}(),function(){var e=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],t="Change.kinetic",n="none",r="up",i="right",s="down",o="left",u="Label",a=e.length;Kinetic.Label=function(e){this.____init(e)},Kinetic.Label.prototype={____init:function(e){var t=this;this.className=u,Kinetic.Group.call(this,e),this.on("add.kinetic",function(e){t._addListeners(e.child),t._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(n){var r,i=this,s=function(){i._sync()};for(r=0;a>r;r++)n.on(e[r]+t,s)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var e,t,n,u,a,l,c=this.getText(),h=this.getTag();if(c&&h){switch(e=c.getWidth(),t=c.getHeight(),n=h.getPointerDirection(),u=h.getPointerWidth(),pointerHeight=h.getPointerHeight(),a=0,l=0,n){case r:a=e/2,l=-1*pointerHeight;break;case i:a=e+u,l=t/2;break;case s:a=e/2,l=t+pointerHeight;break;case o:a=-1*u,l=t/2}h.setAttrs({x:-1*a,y:-1*l,width:e,height:t}),c.setAttrs({x:-1*a,y:-1*l})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(e){this.___init(e)},Kinetic.Tag.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getWidth(),n=this.getHeight(),u=this.getPointerDirection(),a=this.getPointerWidth(),l=this.getPointerHeight();this.getCornerRadius(),e.beginPath(),e.moveTo(0,0),u===r&&(e.lineTo((t-a)/2,0),e.lineTo(t/2,-1*l),e.lineTo((t+a)/2,0)),e.lineTo(t,0),u===i&&(e.lineTo(t,(n-l)/2),e.lineTo(t+a,n/2),e.lineTo(t,(n+l)/2)),e.lineTo(t,n),u===s&&(e.lineTo((t+a)/2,n),e.lineTo(t/2,n+l),e.lineTo((t-a)/2,n)),e.lineTo(0,n),u===o&&(e.lineTo(0,(n+l)/2),e.lineTo(-1*a,n/2),e.lineTo(0,(n-l)/2)),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",n),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Tag)}(),define("app/canvas/CanvasState",["dejavu","app/event/CustomEvent","app/utils/MousePosition","kinetic"],function(e,t,n,r){var i=e.Class.declare({$name:"CanvasState",_baseLayer:null,_canvas:null,_canvasContext:null,_container:null,_controls:null,_height:null,_drawInterval:null,_lastMouseX:null,_lastMouseY:null,_lastValue:null,_pointerLocked:null,_scale:null,_stage:null,_width:null,getBaseLayer:function(){return this._baseLayer},setBaseLayer:function(e){return this._baseLayer=e,this},getCanvas:function(){return this._canvas},setCanvas:function(e){return this._canvas=e,this},getCanvasContext:function(){return this._canvasContext},getContainer:function(){return this._container},getLastMouseX:function(){return this._lastMouseX},setLastMouseX:function(e){this._lastMouseX=e},getLastValue:function(){return this._lastValue},setLastValue:function(e){this._lastValue=e},getLastMouseY:function(){return this._lastMouseY},setLastMouseY:function(e){this._lastMouseY=e},getPointerLocked:function(){return this._pointerLocked},setPointerLocked:function(e){this._pointerLocked=e},getScale:function(){return this._scale},getStage:function(){return this._stage},initialize:function(e,t,n){this._stage=new r.Stage({container:n,width:e,height:t,scale:{x:1,y:1}}),this._container=document.getElementById(n),this._baseLayer=new r.Layer,this._stage.add(this._baseLayer),this._drawInterval=30;var i=this;(function s(){window.requestAnimationFrame(s),i.draw()})(),window.onresize=function(){i.resize()},this._canvas=this._baseLayer.getCanvas()._canvas,document.addEventListener("pointerlockchange",function(){i.lockChangeCallback()},!1),document.addEventListener("mozpointerlockchange",function(){i.lockChangeCallback()},!1),document.addEventListener("webkitpointerlockchange",function(){i.lockChangeCallback()},!1)},addControl:function(e){this.addNodeToBLayer(e.getKineticGroup())},addNodeToBLayer:function(e){this._baseLayer.add(e)},clear:function(){this._canvasContext.clearRect(0,0,this._canvas.width,this._canvas.height)},draw:function(){this._stage.clear(),this._stage.draw()},findPosition:function(){var e=this._canvas,t=0,n=0;if(e.offsetParent){do t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;while(e);return{x:t,y:n}}return undefined},getValueByControlId:function(e){var t=this._controls.length;for(var n=0;n<t;n++){var r=this._controls[n];if(r.getId()==e)return r.getValue()}return null},getMousePosition:function(e){var t,r;if(this._pointerLocked)t=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;else{var i=this.findPosition();t=(e.pageX-i.x)/this._stage.getScale(),r=(e.pageY-i.y)/this._stage.getScale()}return new n(t,r)},lockChangeCallback:function(){document.pointerLockElement===this._container||document.mozPointerLockElement===this._container||document.webkitPointerLockElement===this._container?this._pointerLocked=!0:this._pointerLocked=!1},lockPointer:function(){this._container.requestPointerLock=this._container.requestPointerLock||this._container.mozRequestPointerLock||this._container.webkitRequestPointerLock,this._container.requestPointerLock()},resize:function(){var e=window.innerWidth,t=window.innerHeight,n=this._stage.getWidth(),r=this._stage.getHeight();if(e>=n&&t>=r)this._scale=1,this._stage.setScale({x:1,y:1});else{var i=Math.min(e/this._stage.getWidth(),t/this._stage.getHeight());this._scale=i,this._stage.setScale({x:i,y:i}),this._stage.draw()}},unlockPointer:function(){this._pointerLocked&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock())}});return i}),define("app/controls/Control",["dejavu","kinetic"],function(e,t){var n=e.Class.declare({$name:"Control",_canvasState:null,_id:null,_kineticGroup:null,getId:function(){return this._id},setId:function(e){this._id=e},getCanvasState:function(){return this._canvasState},getKineticGroup:function(){return this._kineticGroup},getX:function(){return this._kineticGroup.getX()},setX:function(e){this._kineticGroup.setX(e)},getY:function(){return this._kineticGroup.getY()},setY:function(e){this._kineticGroup.setY(e)},initialize:function(e,n,r,i){this._id=e,this._canvasState=i,this._kineticGroup=new t.Group,this._kineticGroup.setX(n),this._kineticGroup.setY(r)}});return n}),define("app/controls/ui/UIControl",["dejavu","app/controls/Control"],function(e,t){var n=e.Class.declare({$name:"UIControl",$extends:t,_value:null,_clickCounter:null,_clickEventTStamp:null,_selected:null,getValue:function(){return this._value},setValue:function(e){this._value=e},getClickCounter:function(){return this._clickCounter},setClickCounter:function(e){this._clickCounter=e},getClickEventTStamp:function(){return this._clickEventTStamp},setClickEventTStamp:function(e){this._clickEventTStamp=e},getSelected:function(){return this._selected},setSelected:function(e){this._selected=e},initialize:function(e,t,n,r,i){this.$super(e,t,n,i),this._value=r,this._selected=!1}});return n}),define("app/controls/ui/RangeControl",["dejavu","app/controls/ui/UIControl"],function(e,t){var n=e.Class.declare({$name:"RangeControl",$extends:t,_doubleClickSnapValue:null,_formatter:null,_maxValue:null,_minValue:null,_snapDistance:null,_snapStep:null,_valueDspMult:null,getDoubleClickSnapValue:function(){return this._doubleClickSnapValue},getFormatter:function(){return this._formatter},initialize:function(e,t,n,r,i,s,o,u,a,f,l,c){this.$super(e,t,n,r,i),this._valueDspMult=s,this._minValue=o,this._maxValue=u,this._snapStep=a,this._snapDistance=f,this._doubleClickSnapValue=l,this._formatter=c}});return n}),define("app/controls/ui/Knob",["dejavu","app/controls/ui/RangeControl","app/event/Event","kinetic"],function(e,t,n,r){var i=e.Class.declare({$name:"Knob",$extends:t,_borderColor:null,_color:null,_knobX:null,_knobY:null,_knobCircle:null,_maxPointerRad:null,_minPointerRad:null,_pointerColor:null,_pointer:null,_pointerRadian:null,_radius:null,_valueDisplayArea:null,_valueDisplayText:null,_tmpPointerRad:null,getMaxPointerRad:function(){return this._maxPointerRad},getMaxValue:function(){return this._maxValue},getMinPointerRad:function(){return this._minPointerRad},getMinValue:function(){return this._minValue},getKnobCircle:function(){return this._knobCircle},getPointerRadian:function(){return this._pointerRadian},setPointerRadian:function(e){return this._pointerRadian=e,this},setTmpPointerRad:function(e){return this._tmpPointerRad=e,this},$constants:{LABEL_OFFSET:20,BORDER_WIDTH:5,POINTER_MAX_DEG:393,POINTER_MIN_DEG:147,POINTER_WIDTH:7,VAL_DISPLAY_CORNER_RADIUS:3,VAL_DISPLAY_BORDER_WIDTH:5,VAL_DISPLAY_FONT_SIZE:18,VAL_DISPLAY_HEIGHT:24,VAL_DISPLAY_WIDTH:73,VAL_DISPLAY_Y:32},initialize:function(e,t,s,o,u,a,f,l,c,h,p,d,v,m){this.$super(e,t,s,o,u,a,f,l,p,d,v,m),this._minValue=f,this._maxValue=l;var g=i.POINTER_MAX_DEG-i.POINTER_MIN_DEG;this._minPointerRad=i.calcDegToRad(i.POINTER_MIN_DEG),this._maxPointerRad=i.calcDegToRad(i.POINTER_MAX_DEG),this._radius=c,this._pointerRadian=i.calcRadFromValue(o,this._minPointerRad,this._maxPointerRad,this._minValue,this._maxValue),this._tmpPointerRad=this._pointerRadian,this._knobX=c+this.getX()+i.BORDER_WIDTH,this._knobY=c+this.getY()+i.BORDER_WIDTH,this._knobCircle=new r.Circle({x:this._knobX,y:this._knobY,radius:c,fill:h,id:e}),this._kineticGroup.add(this._knobCircle);var y=c*.02,b=new r.Arc({x:this._knobX,y:this._knobY,innerRadius:c-i.BORDER_WIDTH*y,outerRadius:c,angle:g,rotation:i.POINTER_MIN_DEG,fill:"#000",stroke:"#000"});this._kineticGroup.add(b);var w=this.calcPointerPos();this._pointer=new r.Line({points:[this._knobX,this._knobY,w.x,w.y],stroke:"#000",lineJoin:"round",strokeWidth:i.POINTER_WIDTH*y}),this._kineticGroup.add(this._pointer);var E=c*.018;this._valueDisplayArea=new r.Rect({x:this._knobX-i.VAL_DISPLAY_WIDTH*E/2,y:this._knobY+i.VAL_DISPLAY_Y*y,cornerRadius:i.VAL_DISPLAY_CORNER_RADIUS*E,height:i.VAL_DISPLAY_HEIGHT*E,width:i.VAL_DISPLAY_WIDTH*E,strokeWidth:i.VAL_DISPLAY_BORDER_WIDTH*y,fill:h,stroke:"#000"}),this._kineticGroup.add(this._valueDisplayArea),this._valueDisplayText=new r.Text({fill:"#000",fontSize:i.VAL_DISPLAY_FONT_SIZE*y}),this.updateValueDisplayText(),this._kineticGroup.add(this._valueDisplayText);var S=this,x=this.getCanvasState().getContainer();this._kineticGroup.on("mousedown",function(e){S.getCanvasState().lockPointer(),S.getCanvasState().setLastValue(S.getValue()),S.setSelected(!0)}),x.addEventListener("mousemove",function(e){if(S.getSelected()){var t=S.getCanvasState().getMousePosition(e),r=S.getCanvasState().getBaseLayer();S.update(t),r.setAttr("event",new n(S.getId(),S.getValue(),n.TYPE_VALUE_CHANGED))}}),x.addEventListener("mouseup",function(e){S.getSelected()&&(S.getCanvasState().unlockPointer(),S.setSelected(!1))}),x.addEventListener("dblclick",function(e){var t=S.getCanvasState().getStage(),r=t.getPointerPosition(),s=t.getIntersection(r);if(!s)return;if(S.getId()==s.getId()){S.setValue(S.getDoubleClickSnapValue()),S.setPointerRadian(i.calcRadFromValue(S.getDoubleClickSnapValue(),S.getMinPointerRad(),S.getMaxPointerRad(),S.getMinValue(),S.getMaxValue()));var o=S.calcPointerPos();S.updatePointerPosition(o),S.setTmpPointerRad(S.getPointerRadian()),S.updateValueDisplayText(),S.getCanvasState().getBaseLayer().setAttr("event",new n(S.getId(),S.getValue(),n.TYPE_VALUE_CHANGED))}})},$statics:{calcRadToDeg:function(e){return e*180/Math.PI},calcDegToRad:function(e){return e*Math.PI/180},calcRadFromValue:function(e,t,n,r,i){var s=n-t,o=i-r;return s*(e-r)/o+t},calcValueFromRad:function(e,t,n,r,i){var s=n-t,o=i-r;return o*(e-t)/s+r},pointInCircle:function(e,t,n,r,i){var s=(e-n)*(e-n)+(t-r)*(t-r);return s<=i*i}},calcPointerPos:function(){var e=this._radius/1.23;return{x:Math.cos(this._pointerRadian)*e+this._knobX,y:Math.sin(this._pointerRadian)*e+this._knobY}},getKnobX:function(){return this.getX()+this._radius},getKnobY:function(){return this.getY()+this._radius+i.BORDER_WIDTH/2+(this._label!==null?i.LABEL_OFFSET:0)},update:function(e){if(this._selected){this._clickCounter=0;var t=200,n=e.getY(),r=Math.abs(10*n/t),s,o=!1,u=!0,a=this._canvasState.getLastValue(),f=.05;this._snapStep==0&&(f*=r),n<0?(this._tmpPointerRad+f<=this._maxPointerRad?this._tmpPointerRad+=f:this._tmpPointerRad=this._maxPointerRad,o=!0):n>0?this._tmpPointerRad-f>=this._minPointerRad?this._tmpPointerRad-=f:this._tmpPointerRad=this._minPointerRad:u=!1,s=i.calcValueFromRad(this._tmpPointerRad,this._minPointerRad,this._maxPointerRad,this._minValue,this._maxValue);if(u)if(this._snapStep!=0){var l=!1;o?s-a>=this._snapStep-this._snapDistance&&(l=!0):Math.abs(s-a)>=this._snapStep-this._snapDistance&&(l=!0);if(l){var c=this._snapStep;o?this._value+c<=this._maxValue?this._value=this._value+c:this._value=this._maxValue:this._value-c>=this._minValue?this._value=this._value-c:this._value=this._minValue,this._canvasState.setLastValue(this._value),this._pointerRadian=i.calcRadFromValue(this._value,this._minPointerRad,this._maxPointerRad,this._minValue,this._maxValue);var h=this.calcPointerPos();this.updatePointerPosition(h),this.updateValueDisplayText()}}else{this._pointerRadian=this._tmpPointerRad,this._value=s;var h=this.calcPointerPos();this.updatePointerPosition(h),this.updateValueDisplayText()}}},updateValueDisplayText:function(){var e=this._formatter.format(this._value);this._valueDisplayText.setText(e),$textWidth=this._valueDisplayText.getTextWidth(),$textHeight=this._valueDisplayText.getTextHeight(),this._valueDisplayText.setX(this._knobX-$textWidth/2),this._valueDisplayText.setY(this._valueDisplayArea.getY()+this._valueDisplayArea.getHeight()/2-$textHeight/2)},updatePointerPosition:function(e){this._pointer.setPoints([this._knobX,this._knobY,e.x,e.y])}});return i}),define("mout/array/findIndex",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);if(t==null)return-1;var i=-1,s=t.length;while(++i<s)if(n(t[i],i,t))return i;return-1}return t}),define("mout/array/find",["./findIndex"],function(e){function t(t,n,r){var i=e(t,n,r);return i>=0?t[i]:void 0}return t}),define("mout/lang/defaults",["./toArray","../array/find"],function(e,t){function n(n){return t(e(arguments),r)}function r(e){return e!=null}return n}),define("app/controls/ui/RadioButton",["dejavu","app/event/Event","app/controls/ui/UIControl","mout/lang/defaults"],function(e,t,n,r){var i=e.Class.declare({$name:"RadioButton",$extends:n,_checked:null,_checkedColor:null,_color:null,_fontFormatStr:null,_fontSize:null,_labelText:null,_radius:null,_buttonCircle:null,_checkedCircle:null,_value:null,getChecked:function(){return this._checked},setChecked:function(e){this._checked=e},getValue:function(){return this._value},getRadius:function(){return this._radius},$constants:{BUTTON_RADIUS:10,LABEL_DISPLAY_FONT_SIZE:18,LABEL_BUTTON_SPACE:2,BORDER_WIDTH:3},initialize:function(e,n,s,o,u,a,f,l,c){this.$super(e,n,s,a,o),this._radius=r(c,i.BUTTON_RADIUS),this._canvasState=o,this._checkedColor=l,this._color=f,this._labelText=u,this._value=a,this._buttonCircle=new Kinetic.Circle({x:this.getX()+this._radius+i.BORDER_WIDTH,y:this.getY()+this._radius+i.BORDER_WIDTH,radius:this._radius,fill:f}),this._kineticGroup.add(this._buttonCircle);var h=new Kinetic.Arc({x:this._buttonCircle.getX(),y:this._buttonCircle.getY(),angle:360,fill:f,innerRadius:this._radius-i.BORDER_WIDTH,outerRadius:this._radius,stroke:f});this._kineticGroup.add(h);var u=new Kinetic.Text({fill:"#000",fonzSize:i.LABEL_DISPLAY_FONT_SIZE,text:this._labelText});$textHeight=u.getTextHeight(),u.setX(this._buttonCircle.getX()+this._radius+i.LABEL_BUTTON_SPACE),u.setY(this._buttonCircle.getY()-$textHeight/2),this._kineticGroup.add(u);var p=this;this._kineticGroup.on("click",function(e){p.getCanvasState().getBaseLayer().setAttr("event",new t(p.getId(),p.getValue(),t.TYPE_CHECKED_CHANGED))})},changeCheckedState:function(e){this._checked=e,this._checked?this._buttonCircle.setFill(this._checkedColor):this._buttonCircle.setFill(this._color)}});return i}),define("app/controls/ui/RadioGroup",["dejavu","app/event/Event","app/controls/ui/UIControl","app/controls/ui/RadioButton"],function(e,t,n,r){var i=e.Class.declare({$name:"RadioGroup",$extends:n,_radioButtons:null,_lastRadioY:null,getRadioButtons:function(){return this._radioButtons},initialize:function(e,n,r,i,s){this.$super(e,n,r,i,s),this._lastRadioY=r,this._maxRadius=0,this._radioButtons=[];var o=this;this._isFirstButton=!0,this._kineticGroup.on("click",function(e){var n=o.getCanvasState().getBaseLayer().getAttr("event");if(typeof n!="undefined"&&n.getType()==t.TYPE_CHECKED_CHANGED){var r=o.getRadioButtons(),i=r.length;for(var s=0;s<i;s++){var u=r[s];u.changeCheckedState(!1)}for(var s=0;s<i;s++){var u=r[s];u.getValue()==n.getValue()&&(u.changeCheckedState(!0),o.setValue(u.getValue()),o.getCanvasState().getBaseLayer().setAttr("event",new t(o.getId(),o.getValue(),t.TYPE_VALUE_CHANGED)))}}})},addButton:function(e){e.setY(this._lastRadioY),this._radioButtons.push(e),this._kineticGroup.add(e.getKineticGroup()),e.getValue()==this._value&&e.changeCheckedState(!0),this._lastRadioY+=e.getRadius()*2+5}});return i}),define("app/controls/ui/Fader",["dejavu","app/controls/ui/RangeControl","app/event/Event","kinetic"],function(e,t,n,r){var i=e.Class.declare({$name:"Fader",$extends:t,_borderColor:null,_color:null,_faderBorder:null,_faderKnob:null,_length:null,_position:null,_orientation:null,_tmpPosition:null,_trackLength:null,_startTrackX:null,_startTrackY:null,_valueDisplayArea:null,_valueDisplayText:null,$constants:{ORIENTATION_HORIZONTAL:0,ORIENTATION_VERTICAL:1,LABEL_OFFSET:20,FADER_KNOB_HEIGHT:30,FADER_KNOB_WIDTH:40,FADER_TRACK_HEIGHT:30,FADER_TRACK_BORDER_WIDTH:5,BORDER_RADIUS:3,VAL_DISPLAY_AREA_WIDTH:60,VAL_DISPLAY_AREA_HEIGHT:30,VAL_DISPLAY_FONT_SIZE:18},initialize:function(e,t,s,o,u,a,f,l,c,h,p,d,v,m,g){this.$super(e,t,s,o,u,a,f,l,p,d,v,m),this._length=c,this._color=h,this._orientation=g,height=this._length,width=i.FADER_TRACK_HEIGHT,i.ORIENTATION_HORIZONTAL==this._orientation&&(height=i.FADER_TRACK_HEIGHT,width=this._length),this._faderBorder=new r.Rect({cornerRadius:i.BORDER_RADIUS,height:height,width:width,strokeWidth:i.FADER_TRACK_BORDER_WIDTH,fill:h,stroke:"#000",id:e}),this._kineticGroup.add(this._faderBorder),this._trackLength=this._length*.9,this._tmpPosition=this.calcPositionFromValue(o),this._startTrackX=i.FADER_TRACK_HEIGHT/2,this._startTrackY=(this._length-this._trackLength)/2,i.ORIENTATION_HORIZONTAL==this._orientation&&(this._startTrackX=(this._length-this._trackLength)/2,this._startTrackY=i.FADER_TRACK_HEIGHT/2),endPointX=this._startTrackX,endPointY=this._startTrackY+this._trackLength,i.ORIENTATION_HORIZONTAL==this._orientation&&(endPointX=this._startTrackX+this._trackLength,endPointY=this._startTrackY),trackLine=new Kinetic.Line({points:[this._startTrackX,this._startTrackY,endPointX,endPointY],strokeWidth:i.FADER_TRACK_BORDER_WIDTH,lineCap:"round",lineJoin:"round",stroke:"#000"}),this._kineticGroup.add(trackLine),height=i.FADER_KNOB_HEIGHT,width=i.FADER_KNOB_WIDTH,i.ORIENTATION_HORIZONTAL==this._orientation&&(height=i.FADER_KNOB_WIDTH,width=i.FADER_KNOB_HEIGHT),this._faderKnob=new Kinetic.Rect({cornerRadius:i.BORDER_RADIUS,height:height,width:width,strokeWidth:i.FADER_TRACK_BORDER_WIDTH,fill:h,stroke:"#000"}),this._kineticGroup.add(this._faderKnob),displayAreaX=this._startTrackX-i.VAL_DISPLAY_AREA_WIDTH/2,displayAreaY=this._trackLength+i.VAL_DISPLAY_AREA_HEIGHT,i.ORIENTATION_HORIZONTAL==this._orientation&&(displayAreaX=-1*i.VAL_DISPLAY_AREA_WIDTH-this._startTrackX,displayAreaY=0),this._valueDisplayArea=new Kinetic.Rect({x:displayAreaX,y:displayAreaY,cornerRadius:i.BORDER_RADIUS,height:i.VAL_DISPLAY_AREA_HEIGHT,width:i.VAL_DISPLAY_AREA_WIDTH,strokeWidth:i.FADER_TRACK_BORDER_WIDTH,fill:h,stroke:"#000"}),this._kineticGroup.add(this._valueDisplayArea),this._valueDisplayText=new Kinetic.Text({fill:"#000",fontSize:i.VAL_DISPLAY_FONT_SIZE}),this._kineticGroup.add(this._valueDisplayText),this.updateValueDisplayText(),this.updateKnobPosition(this._tmpPosition);var y=this,b=this.getCanvasState().getContainer();this._faderKnob.on("mousedown",function(e){y.getCanvasState().lockPointer(),y.getCanvasState().setLastValue(y.getValue()),y.setSelected(!0)}),b.addEventListener("mousemove",function(e){if(y.getSelected()){var t=y.getCanvasState().getMousePosition(e),r=y.getCanvasState().getBaseLayer();y.update(t),r.setAttr("event",new n(y.getId(),y.getValue(),n.TYPE_VALUE_CHANGED))}}),b.addEventListener("mouseup",function(e){y.getSelected()&&(y.setSelected(!1),y.getCanvasState().unlockPointer())}),b.addEventListener("dblclick",function(e){var t=y.getCanvasState().getStage(),n=t.getPointerPosition(),r=t.getIntersection(n);if(!r)return;if(y.getId()==r.getId()){y.setValue(y.getDoubleClickSnapValue());var i=y.calcPositionFromValue(y.getValue());y.updateKnobPosition(i)}})},calcKnobPosition:function(e){var t=this._faderKnob,n=t.getHeight(),r=t.getWidth();return i.ORIENTATION_HORIZONTAL==this._orientation?(knobX=this._startTrackX+(e-r/2),knobY=this._startTrackY-n/2):(knobX=this._startTrackX-r/2,knobY=this._startTrackY+(this._trackLength-e-n/2)),{x:knobX,y:knobY}},calcPositionFromValue:function(e){var t=this._maxValue-this._minValue;return this._trackLength*e/t},calcValueFromPosition:function(e){var t=this._minValue,n=this._maxValue,r=this._maxValue-this._minValue;return 0==e?this._minValue:this._minValue+r*e/this._trackLength},update:function(e){if(this._selected){var t=!1,n=this._canvasState.getLastValue(),r=0,s=200,o=this._trackLength,u;i.ORIENTATION_HORIZONTAL==this._orientation?r=e.getX():r=-1*e.getY();var a=Math.abs(10*r/s),f=2.05,l=!0;0==this._snapStep&&(f*=a),r<0?(this._tmpPosition-f>0?this._tmpPosition-=f:this._tmpPosition=0,t=!0):r>0?this._tmpPosition+f<o?this._tmpPosition+=f:this._tmpPosition=o:l=!1;var c=this._knob;u=this.calcValueFromPosition(this._tmpPosition);if(l)if(this._snapStep!=0){var h=!1;t&&u-n>=this._snapStep-this._snapDistance?h=!0:Math.abs(u-n)>=this._snapStep-this._snapDistance&&(h=!0);if(h){var p=this._snapStep;t?this._value-p>=this._minValue?this._value=this._value-p:this._value=this._minValue:this._value+p<=this._maxValue?this._value=this._value+p:this._value=this._maxValue,this._canvasState.setLastValue(this._value),this._tmpPosition=this.calcPositionFromValue(this._value),this.updateKnobPosition(this._tmpPosition),this.updateValueDisplayText()}}else{var c=this._knob;this._value=u,this.updateKnobPosition(this._tmpPosition),this.updateValueDisplayText()}}},updateKnobPosition:function(e){var t=this._faderKnob,n=this.calcKnobPosition(e);t.setX(n.x),t.setY(n.y)},updateValueDisplayText:function(){var e=this._formatter.format(this._value*this._valueDspMult);this._valueDisplayText.setText(e),$textWidth=this._valueDisplayText.getTextWidth(),$textHeight=this._valueDisplayText.getTextHeight(),$displayTextX=this._startTrackX-$textWidth/2,$displayTextY=this._valueDisplayArea.getY()+this._valueDisplayArea.getHeight()/2-$textHeight/2,i.ORIENTATION_HORIZONTAL==this._orientation&&($displayTextX=this._valueDisplayArea.getX()+i.VAL_DISPLAY_AREA_WIDTH/2-$textWidth/2),this._valueDisplayText.setX($displayTextX),this._valueDisplayText.setY($displayTextY)}});return i}),define("app/audio/utils/Audio",["dejavu"],function(e){var t=e.Class.declare({$name:"Audio",$statics:{calcFreqByKey:function(e){return Math.pow(2,(e-49)/12)*440},calcKeyByFreq:function(e){return Math.log(e/127.09)*23+27.5},calcCentsByNumOfHt:function(e){return e*100},calcCentsByNumOfHt:function(e){return e*1200}}});return t}),define("app/audio/Synthesizer",["dejavu","app/audio/utils/Audio"],function(e,t){var n=e.Class.declare({$name:"Synthesizer",_audioContext:null,_osc1:null,_osc1Gain:null,_osc2:null,_osc2Gain:null,_envelopeGain:null,_masterGain:null,_envelopeAttack:null,_envelopeDecay:null,_envelopeSustain:null,_envelopeRelease:null,_filter:null,_noteIsOn:null,getOsc1:function(){return this._osc1},getOsc1Gain:function(){return this._osc1Gain},getOsc2:function(){return this._osc2},getOsc2Gain:function(){return this._osc2Gain},getMasterGain:function(){return this._masterGain},setEnvelopeAttack:function(e){this._envelopeAttack=e},setEnvelopeDecay:function(e){this._envelopeDecay=e},setEnvelopeSustain:function(e){this._envelopeSustain=e},setEnvelopeRelease:function(e){this._envelopeRelease=e},getFilter:function(){return this._filter},$constants:{WAVEFORM_SINE:0,WAVEFORM_SQUARE:1,WAVEFORM_SAWTOOTH:2,WAVEFORM_TRIANGLE:3,WAVEFORM_CUSTOM:4,FILTER_LOWPASS:"lowpass",FILTER_BANDPASS:"bandpass",FILTER_HIGHPASS:"highpass",FILTER_OFF:"off"},initialize:function(e){this._audioContext=e},init:function(){this._osc1=this._audioContext.createOscillator(),this._osc1.frequency.value=0,this._osc1Gain=this._audioContext.createGainNode(),this._osc1Gain.gain.value=1,this._osc2=this._audioContext.createOscillator(),this._osc2.type=0,this._osc2.frequency.value=0,this._osc2Gain=this._audioContext.createGainNode(),this._osc2Gain.gain.value=1,this._envelopeGain=this._audioContext.createGainNode(),this._envelopeGain.gain.value=0,this._masterGain=this._audioContext.createGainNode(),this._masterGain.gain.value=1,this._filter=this._audioContext.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=22050,this._filter.Q.value=1e-4,this._osc1.connect(this._osc1Gain),this._osc2.connect(this._osc2Gain),this._osc1Gain.connect(this._envelopeGain),this._osc2Gain.connect(this._envelopeGain),this._envelopeGain.connect(this._filter),this._filter.connect(this._masterGain),this._masterGain.connect(this._audioContext.destination),this._envelopeAttack=1,this._envelopeDecay=2,this._envelopeSustain=.5,this._envelopeRelease=1,this._noteIsOn=!1,this._osc1.start(0),this._osc2.start(0)},noteOn:function(e){if(!this._noteIsOn){this._noteIsOn=!0;var n=t.calcFreqByKey(e),r=this._audioContext.currentTime;this._osc1.frequency.setValueAtTime(n,r),this._osc2.frequency.setValueAtTime(n,r),this._envelopeGain.gain.cancelScheduledValues(0),this._envelopeGain.gain.setValueAtTime(0,r),this._envelopeGain.gain.linearRampToValueAtTime(1,r+this._envelopeAttack),this._envelopeGain.gain.exponentialRampToValueAtTime(this._envelopeSustain,r+this._envelopeAttack+this._envelopeDecay)}},noteOff:function(){var e=this._audioContext.currentTime;this._envelopeGain.gain.cancelScheduledValues(0),this._envelopeGain.gain.setValueAtTime(this._envelopeGain.gain.value,e),this._envelopeGain.gain.linearRampToValueAtTime(0,e+this._envelopeRelease),this._noteIsOn=!1}});return n}),define("app/utils/formatter/Formatter",["dejavu"],function(e,t){var n=e.AbstractClass.declare({$name:"Formatter",$abstracts:{format:function(e){}}});return n}),define("app/utils/formatter/NumberFormatter",["dejavu","app/utils/formatter/Formatter"],function(e,t){var n=e.Class.declare({$name:"NumberFormatter",$extends:t,_pattern:null,initialize:function(e){this._pattern=e},format:function(e){var t=this._pattern,n=e;if(!t||isNaN(+n))return n;n=t.charAt(0)=="-"?-n:+n;var r=n<0?n=-n:0,i=t.match(/[^\d\-\+#]/g),s=i&&i[i.length-1]||".",o=i&&i[1]&&i[0]||",";t=t.split(s),n=n.toFixed(t[1]&&t[1].length),n=+n+"";var u=t[1]&&t[1].lastIndexOf("0"),a=n.split(".");if(!a[1]||a[1]&&a[1].length<=u)n=(+n).toFixed(u+1);var f=t[0].split(o);t[0]=f.join("");var l=t[0]&&t[0].indexOf("0");if(l>-1)while(a[0].length<t[0].length-l)a[0]="0"+a[0];else+a[0]==0&&(a[0]="");n=n.split("."),n[0]=a[0];var c=f[1]&&f[f.length-1].length;if(c){var h=n[0],p="",d=h.length%c;for(var v=0,m=h.length;v<m;v++)p+=h.charAt(v),!((v-d+1)%c)&&v<m-c&&(p+=o);n[0]=p}return n[1]=t[1]&&n[1]?s+n[1]:"",(r?"-":"")+n[0]+n[1]}});return n}),define("app/controls/layout/LayoutControl",["dejavu","app/controls/Control"],function(e,t){var n=e.Class.declare({$name:"LayoutControl",$extends:t,initialize:function(e,t,n,r){this.$super(e,t,n,r)}});return n}),define("app/controls/layout/Label",["dejavu","app/controls/layout/LayoutControl"],function(e,t){var n=e.Class.declare({$name:"Label",$extends:t,_color:null,_text:null,getColor:function(){return this._color},setColor:function(e){return this._color=e,this},getText:function(){return this._text},setText:function(e){return this._text=e,this},initialize:function(e,t,n,r,i,s){this.$super(e,t,n,r),this._color=i,this._text=s,$textContainer=new Kinetic.Text({fill:i,fontSize:16,text:s}),this._kineticGroup.add($textContainer)}});return n}),require.config({baseUrl:"js/vendor",paths:{app:"../app",mout:"mout/src",kinetic:"kinetic-v5.0.1.min"},packages:[{name:"dejavu",location:"js-dejavu/dist/amd/strict"}],shim:{kinetic:{exports:"Kinetic"}}}),requirejs(["app/event/Event","app/canvas/CanvasState","app/controls/ui/Knob","app/controls/ui/RadioGroup","app/controls/ui/RadioButton","app/controls/ui/Fader","app/audio/Synthesizer","app/utils/formatter/NumberFormatter","app/controls/layout/Label"],function(e,t,n,r,i,s,o,u,a){function k(){var t=N.getBaseLayer().getAttr("event"),n=L.currentTime;if(typeof t!="undefined"&&t.getType()==e.TYPE_VALUE_CHANGED)switch(t.getControlId()){case l:A.getOsc1().type=t.getValue();break;case c:A.getOsc1().detune.setValueAtTime(t.getValue()*100,n);break;case p:A.getOsc1().detune.setValueAtTime(t.getValue()*1200,n);break;case h:A.getOsc1Gain().gain.setValueAtTime(t.getValue(),n);break;case d:A.getOsc2().type=t.getValue();break;case v:A.getOsc2().detune.setValueAtTime(t.getValue()*100,n);break;case g:A.getOsc2().detune.setValueAtTime(t.getValue()*1200,n);break;case m:A.getOsc2Gain().gain.setValueAtTime(t.getValue(),n);break;case f:A.getMasterGain().gain.setValueAtTime(t.getValue(),n);break;case y:A.setEnvelopeAttack(t.getValue());break;case b:A.setEnvelopeDecay(t.getValue());break;case w:A.setEnvelopeSustain(t.getValue());break;case E:A.setEnvelopeRelease(t.getValue());break;case S:A.getFilter().type=t.getValue();break;case x:A.getFilter().frequency.setValueAtTime(t.getValue(),n);break;case T:A.getFilter().Q.setValueAtTime(t.getValue(),n)}}var f=1,l=2,c=3,h=4,p=5,d=6,v=7,m=8,g=9,y=10,b=11,w=12,E=13,S=14,x=15,T=16,N=new t(600,600,"syn"),C=new r(l,0,20,o.WAVEFORM_SINE,N);C.addButton(new i(0,0,0,N,"Sine",o.WAVEFORM_SINE,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Square",o.WAVEFORM_SQUARE,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Saw",o.WAVEFORM_SAWTOOTH,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Triangle",o.WAVEFORM_TRIANGLE,"#000","#FFF")),N.addControl(C),N.addControl(new a(1,0,20,N,"#000","OSC1-Waveform")),N.addControl(new n(c,60,20,0,N,1,-12,12,50,"#AABBCC",0,.5,0,new u("#0"))),N.addControl(new a(1,130,20,N,"#000","OSC1-Tune")),N.addControl(new n(p,120,20,0,N,1,-4,4,50,"#AABBCC",1,.5,0,new u("#0"))),N.addControl(new a(1,250,20,N,"#000","OSC1-Octave")),N.addControl(new n(h,180,20,1,N,100,0,1,50,"#AABBCC",0,0,null,new u("#0.0"))),N.addControl(new a(1,370,20,N,"#000","OSC1-Gain")),N.addControl(new a(1,0,180,N,"#000","OSC2-Waveform")),C=new r(d,0,100,o.WAVEFORM_SINE,N),C.addButton(new i(0,0,0,N,"Sine",o.WAVEFORM_SINE,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Square",o.WAVEFORM_SQUARE,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Saw",o.WAVEFORM_SAWTOOTH,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Triangle",o.WAVEFORM_TRIANGLE,"#000","#FFF")),N.addControl(C),N.addControl(new n(v,60,100,0,N,1,-12,12,50,"#AABBCC",0,.5,0,new u("#0"))),N.addControl(new a(1,130,180,N,"#000","OSC1-Tune")),N.addControl(new n(g,120,100,0,N,1,-4,4,50,"#AABBCC",1,.5,0,new u("#0"))),N.addControl(new a(1,250,180,N,"#000","OSC1-Octave")),N.addControl(new n(m,180,100,1,N,100,0,1,50,"#AABBCC",0,0,null,new u("#0.0"))),N.addControl(new a(1,370,180,N,"#000","OSC1-Gain")),N.addControl(new n(f,240,60,1,N,100,0,1,50,"#AABBCC",0,0,null,new u("#0.0"))),N.addControl(new a(1,490,100,N,"#000","Mastergain")),N.addControl(new a(1,0,320,N,"#000","ADSR-Envelope")),N.addControl(new n(y,0,180,1,N,1,0,6,30,"#AABBCC",0,0,null,new u("#0"))),N.addControl(new a(1,30,345,N,"#000","A")),N.addControl(new n(b,40,180,2,N,1,0,6,30,"#AABBCC",0,0,null,new u("#0"))),N.addControl(new a(1,110,345,N,"#000","D")),N.addControl(new n(w,80,180,.5,N,100,0,1,30,"#AABBCC",0,0,null,new u("#0"))),N.addControl(new a(1,190,345,N,"#000","S")),N.addControl(new n(E,120,180,1,N,1,0,6,30,"#AABBCC",0,0,null,new u("#0"))),N.addControl(new a(1,270,345,N,"#000","R")),N.addControl(new a(1,350,320,N,"#000","Filter")),N.addControl(new a(1,350,340,N,"#000","Type")),C=new r(S,350,180,o.FILTER_LOWPASS,N),C.addButton(new i(0,0,0,N,"Lowpass",o.FILTER_LOWPASS,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Bandpass",o.FILTER_BANDPASS,"#000","#FFF")),C.addButton(new i(0,0,0,N,"Highpass",o.FILTER_HIGHPASS,"#000","#FFF")),N.addControl(C),N.addControl(new a(1,450,340,N,"#000","Freq")),N.addControl(new s(x,450,370,22050,N,1,60,22050,150,"#AABBCC",0,0,0,new u("#0"),s.ORIENTATION_VERTICAL)),N.addControl(new a(1,530,340,N,"#000","Res")),N.addControl(new s(T,530,370,1e-4,N,1,1e-4,50,150,"#AABBCC",0,0,0,new u("#0"),s.ORIENTATION_VERTICAL)),N.getContainer().addEventListener("mousemove",function(e){N.getPointerLocked()&&k()}),N.getContainer().addEventListener("click",function(e){k()});var L=new webkitAudioContext,A=new o(L);A.init(),window.addEventListener("keyup",function(){A.noteOff()}),window.addEventListener("keydown",function(e){e.keyCode==65&&A.noteOn(52),e.keyCode==87&&A.noteOn(53),e.keyCode==83&&A.noteOn(54),e.keyCode==69&&A.noteOn(55),e.keyCode==68&&A.noteOn(56),e.keyCode==70&&A.noteOn(57),e.keyCode==84&&A.noteOn(58),e.keyCode==71&&A.noteOn(59),e.keyCode==90&&A.noteOn(60),e.keyCode==72&&A.noteOn(61),e.keyCode==85&&A.noteOn(62),e.keyCode==74&&A.noteOn(63),e.keyCode==75&&A.noteOn(64)})}),define("app",function(){});